var key,hibipart=function(){var edges,module={},nodes={},structure={},arcFilters=[],arcEFilters=[],sideAccessor=function(d){return d.side},nameAccessor=function(d){return d.name},idAccessor=function(d){return d.id},parentAccessor=function(d){return d.parent},sortFunction=function(a,b){return a.side<b.side?-1:a.side>b.side?1:"c_ic"!=a.side?a.name<b.name?-1:a.name>b.name?1:0:a.name>b.name?-1:a.name<b.name?1:0};return module.init=function(nodesData,edgesData){nodesData.forEach(function(d){nodes[idAccessor(d)]={edges:{direct:{},all:{},fDirect:{},fAll:{}},count:0,level:0,directCount:0,path:[],oPath:[],visible:-1==parentAccessor(d),side:sideAccessor(d),name:nameAccessor(d),id:idAccessor(d),parent:parentAccessor(d),children:[],o:d}}),edges=edgesData.filter(function(d){return d.source in nodes&&d.target in nodes}),module.parse()},module.parse=function(){var id,_side,tnodes=[];for(id in nodes)tnodes.push(nodes[id]);for(;0<tnodes.length;)for(var i=tnodes.length-1;0<=i;i--){var side=tnodes[i].side,parent=tnodes[i].parent,_id=tnodes[i].id,name=tnodes[i].name;if(-1==parent)side in structure||(structure[side]=[]),structure[side].push({id:_id,count:0,level:0,directCount:0,side:side,name:name,children:[],edges:{direct:{},all:{}}}),nodes[_id].path=[structure[side].length-1],nodes[_id].oPath=[_id],tnodes.splice(i,1);else if(0<nodes[parent].path.length){for(var path=nodes[parent].path,oPath=nodes[parent].oPath,s=structure[side][path[0]].children,si=1;si<path.length;si++)s=s[path[si]].children;s.push({id:_id,count:0,level:path.length,directCount:0,name:name,children:[],edges:{direct:{},all:{}}}),nodes[parent].children.push(_id),nodes[_id].path=path.concat([s.length-1]),nodes[_id].oPath=oPath.concat([_id]),tnodes.splice(i,1)}}for(_side in structure)module.sort(structure[_side]),module.hashOut(structure[_side],[]);edges.forEach(function(e){nodes[e.source].edges.direct[e.target]=e.weight,nodes[e.target].edges.direct[e.source]=e.weight}),module.update()},module.hashOut=function(_nodes,_path){_nodes.forEach(function(n,ni){nodes[n.id].path=_path.concat([ni]),"children"in n&&module.hashOut(n.children,_path.concat([ni]))})},module.sort=function(nodes){nodes.sort(sortFunction),nodes.forEach(function(n){"children"in n&&module.sort(n.children)})},module.getStructure=function(){return structure},module.getNodes=function(){return nodes},module.update=function(){for(var side in module.count(nodes),structure)module.updateStructure(nodes,structure[side]);return structure},module.count=function(nodes){for(var nID in nodes)nodes[nID].visible=-1==nodes[nID].parent||0<=arcFilters.indexOf(parseInt(nodes[nID].parent));for(var _nID in nodes)-1==nodes[_nID].parent&&module.countChildren(nodes[_nID])},module.countChildren=function(node){var eID,nID=parseInt(node.id),dummy={edges:{}};for(eID in dummy.edges.fAll=nodes[nID].edges.fAll={},dummy.edges.fDirect=nodes[nID].edges.fDirect={},dummy.count=nodes[nID].count=0,dummy.directCount=nodes[nID].directCount=0,nodes[nID].edges.direct){for(var pi=nodes[eID].oPath.length-1,add=arcFilters.length;!nodes[nodes[eID].oPath[pi]].visible;)pi--;1<=arcFilters.length&&(add=0,1==arcEFilters.length?((0<=arcEFilters.indexOf(nID)||0<=arcEFilters.indexOf(parseInt(eID)))&&(add=arcFilters.length),(0<=arcEFilters.indexOf(parseInt(nodes[nID].parent))||0<=arcEFilters.indexOf(parseInt(nodes[eID].parent)))&&(add=arcFilters.length)):1<arcEFilters.length&&(0<=arcEFilters.indexOf(parseInt(nID))&&0<=arcEFilters.indexOf(parseInt(eID))&&(add=arcFilters.length),0<=arcEFilters.indexOf(parseInt(nodes[nID].parent))&&0<=arcEFilters.indexOf(parseInt(nodes[eID].parent))&&nodes[eID].parent!=nodes[nID].parent&&(add=arcFilters.length),0<=arcEFilters.indexOf(parseInt(nID))&&0<=arcEFilters.indexOf(parseInt(nodes[eID].parent))&&nodes[eID].parent!=nID&&(add=arcFilters.length),0<=arcEFilters.indexOf(parseInt(nodes[nID].parent))&&0<=arcEFilters.indexOf(parseInt(eID))&&eID!=nodes[nID].parent&&(add=arcFilters.length))),add>=arcFilters.length&&(dummy.directCount+=nodes[nID].edges.direct[eID],nodes[eID].oPath[pi]in dummy.edges.fDirect||(dummy.edges.fDirect[nodes[eID].oPath[pi]]={c:0}),dummy.edges.fDirect[nodes[eID].oPath[pi]].c+=nodes[nID].edges.direct[eID],nodes[eID].oPath[pi]!=nID&&(dummy.count+=nodes[nID].edges.direct[eID],nodes[eID].oPath[pi]in dummy.edges.fAll||(dummy.edges.fAll[nodes[eID].oPath[pi]]={c:0}),dummy.edges.fAll[nodes[eID].oPath[pi]].c+=nodes[nID].edges.direct[eID]))}for(var i=0;i<nodes[nID].children.length;i++){var rID,fAll=module.countChildren(nodes[nodes[nID].children[i]]);for(rID in fAll)0<=arcFilters.indexOf(parseInt(nID))||(rID in dummy.edges.fAll||(dummy.edges.fAll[rID]={c:0}),dummy.edges.fAll[rID].c+=fAll[rID].c,dummy.count+=fAll[rID].c)}return nodes[nID].visible&&(nodes[nID].edges.fAll=dummy.edges.fAll,nodes[nID].edges.fDirect=dummy.edges.fDirect,nodes[nID].count=dummy.count,nodes[nID].directCount=dummy.directCount),dummy.edges.fAll},module.updateStructure=function(nodes,structure){structure.forEach(function(s){s.count=nodes[s.id].count,s.directCount=nodes[s.id].directCount,s.edges.direct=nodes[s.id].edges.fDirect,s.edges.all=nodes[s.id].edges.fAll,module.updateStructure(nodes,s.children)})},module.clone=function(source,target){source.forEach(function(s){target.push({id:s.id,count:s.count,directCount:s.directCount,name:s.name,children:[]}),module.clone(s.children,target[target.length-1].children)})},module.reset=function(){return arcFilters=[],module.update()},module.filter=function(id){return id in nodes&&(arcFilters.indexOf(parseInt(id))<0?(function filterArcs(id){arcFilters.indexOf(parseInt(id))<0&&(arcFilters.push(id),module.updateFilterStructure());-1<nodes[id].parent&&filterArcs(nodes[id].parent)}(id),module.update()):structure)},module.unFilter=function(id){return id in nodes&&(arcFilters.indexOf(parseInt(id))<0?structure:(arcFilters.splice(arcFilters.indexOf(parseInt(id)),1),module.updateFilterStructure(),function unfilterChildArcs(id){var removed=[];arcFilters.forEach(function(f){nodes[f].parent==id&&removed.push(f)});1<=removed.length&&removed.forEach(function(r){arcFilters.splice(arcFilters.indexOf(parseInt(r)),1),unfilterChildArcs(r)})}(id),module.update()))},module.updateFilterStructure=function(){arcEFilters=[];var banFilters=[];arcFilters.forEach(function(a){-1!=nodes[a].parent&&banFilters.push(nodes[a].parent)}),arcFilters.forEach(function(a){banFilters.indexOf(a)<0&&arcEFilters.push(a)})},module.getArcFilters=function(){return arcFilters},module.getArcEFilters=function(){return arcEFilters},module.idAccessor=function(_idAccessor){return idAccessor=_idAccessor,module},module.parentAccessor=function(_parentAccessor){return parentAccessor=_parentAccessor,module},module.sideAccessor=function(_sideAccessor){return sideAccessor=_sideAccessor,module},module.nameAccessor=function(_nameAccessor){return nameAccessor=_nameAccessor,module},module.sortFunction=function(_sortFunction){return sortFunction=_sortFunction,module},module},hibipartVis=function(_container,_callback){var bipart,structure,nodes,sides,width,height,g,radius,gEdges,gArcs,module={set selection(_selection){arcFilters=_selection},get selection(){return arcFilters}},callback=_callback,container=_container,labelSides={},arc=d3.arc(),labelWidth=250,padding=50,outerArcs={},gLabels={},gap=Math.PI/180*.5;module.updateSize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,height=bb.height},module.updateSize();var svg=container.append("svg").attr("width",width).attr("height",height);function updateRadius(){width&&height&&function(){radius=width<height?width/2:height/2;var side,peaks=[0,180,360],peak=!1,closestPeak=!1,peakDiff=360;for(side in sides)!function(side){peaks.forEach(function(p){sides[side].start<p&&sides[side].end>p?peak=!0:peak||["start","end"].forEach(function(a){var diff=Math.abs(sides[side][a]-p);diff<peakDiff&&(peakDiff=diff,closestPeak=sides[side][a])})})}(side);peak&&(closestPeak=0);var p=polarToCartesian(closestPeak,radius=height/2-2*padding);radius=radius/Math.abs(p[1])*(height/2-2*padding),width/2-radius<labelWidth+padding&&(radius=width/2-labelWidth-padding)}()}function countChildrenArc(_structure){var sum=0,gaps=0;return _structure.forEach(function(node){var result;nodes[node.id].visible&&(0<=arcFilters.indexOf(parseInt(node.id))?(result=countChildrenArc(node.children),sum+=result[0],sum+=node.directCount,0<node.directCount&&gaps++,gaps+=result[1]):(sum+=node.count,0<node.count&&gaps++))}),[sum,gaps]}function sortEdges(node,sortKey,keyKey,key){var eID,sourceAngle=node.a2;for(eID in node.edges[sortKey]=[],node.edges[keyKey]={},node.edges[key]){var diff=walkPath(structure[nodes[eID].side],nodes[eID].path,0).a1;diff<sourceAngle&&(diff+=2*Math.PI);diff=diff-sourceAngle;Math.PI,eID==nodes[node.id].parent&&(diff=2*Math.PI),node.edges[sortKey].push({id:eID,angle:diff,c:node.edges[key][eID].c})}node.edges[sortKey].sort(function(a,b){return a.angle<b.angle?1:a.angle>b.angle?-1:0}),node.edges[sortKey].forEach(function(e,ei){node.edges[keyKey][e.id]=ei}),node.children.forEach(function(c){sortEdges(c,sortKey,keyKey,key)})}function arcTween(endAngle,startAngle,arc){return function(d){var interpolateEnd=d3.interpolate(d.endAngle,endAngle),interpolateStart=d3.interpolate(d.startAngle,startAngle);return function(t){return d.endAngle=interpolateEnd(t),d.startAngle=interpolateStart(t),arc(d)}}}function getMulti(structure,start,end,direct){var sum=direct;return structure.forEach(function(node){sum+=node.count}),(end-start-(structure.length-1)*gap)/sum}module.scrollTop=function(){window.scrollTo(0,0),document.body.scrollTop=0},module.tour=new Shepherd.Tour({defaultStepOptions:{showCancelLink:!0}}),module.tour.on("show",module.scrollTop),module.tour.addStep("step-1",{title:"Sustainability & Inner Change",text:"The visualisation explores the relationship between the Sustainability and Inner Change taxonomy.",buttons:[{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-2",{title:"Sustainability & Inner Change",text:"Select taxonomies in order to dive deeper into the topic.",attachTo:".label left",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3",{title:"Sustainability & Inner Change",text:"You can use the type filters narrow down the results to a specific type.",attachTo:{element:"#type-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-4",{title:"Sustainability & Inner Change",text:"Selecting taxonomies act as filters. The number of resulting items is displayed below.",attachTo:{element:"#result-display",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-5",{title:"Sustainability & Inner Change",text:"All filtered items are displayed as a list below the visualisation.",attachTo:".connection top",scrollTo:!0,buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]}).on("before-show",module.scrollTop),container.append("button").attr("id","master-help-button").text("?").on("click",function(){module.tour.start()}),module.responsive=function(){for(var side in svg.attr("width",width).attr("height",height),g.attr("transform","translate("+width/2+","+height/2+")"),updateRadius(),arc.innerRadius(radius+5).outerRadius(radius+10),structure)outerArcs[side].attr("d",arc);module.update()},module.render=function(){for(var side in g=svg.append("g").attr("transform","translate("+width/2+","+height/2+")"),gEdges=g.append("g"),gArcs=g.append("g"),updateRadius(),arc.innerRadius(radius+5).outerRadius(radius+10),structure)outerArcs[side]=gArcs.append("path").attr("class","l1").datum({startAngle:sides[side].start,endAngle:sides[side].end}).attr("d",arc),gLabels[side]=g.append("g");module.draw()},module.draw=function(){var side,_side2,_side3,_side4,multi=2*Math.PI,sums={},biggestGap=0,biggestSum=0,sideGaps={};for(side in structure){var tMulti=function countChildren(_structure){var sum=0;var gaps=0;_structure.forEach(function(node){var result;nodes[node.id].visible&&(0<=arcFilters.indexOf(parseInt(node.id))?(result=countChildren(node.children),sum+=result[0],sum+=node.directCount,0<node.directCount&&gaps++,gaps+=result[1]):(sum+=node.count,0<node.count&&gaps++))});return[sum,gaps]}(structure[side]),sum=tMulti[0],gaps=tMulti[1];sums[side]=sum,sideGaps[side]=gaps-1;tMulti=(sides[side].end-sides[side].start-(gaps-1)*gap)/sum;tMulti<multi&&(multi=tMulti,biggestSum=sum,biggestGap=gaps-1)}for(_side2 in structure){labelSides[_side2]=[],function arcGroup(offset,multi,structure,level,side){var arc=d3.arc().innerRadius(radius-10*level-5).outerRadius(radius-10*level);structure.forEach(function(node){(nodes[node.id].visible&&0<node.count||0<=arcFilters.indexOf(parseInt(node.id)))&&(node.a1=offset,0<=arcFilters.indexOf(parseInt(node.id))?(datum=countChildrenArc(node.children),offset+=nodes[node.id].directCount*multi+datum[0]*multi+gap*datum[1]):offset+=nodes[node.id].count*multi,node.a2=offset),null==node.a1&&(node.a1=offset),null==node.a2&&(node.a2=offset);var oldA1=node.a1,oldA2=node.a2,datum=gArcs.select("#arc"+node.id);if(datum.empty()?gArcs.append("path").attr("class","arc l2").attr("id","arc"+node.id).on("mouseover",function(){var id=d3.select(this).datum().id;d3.selectAll("svg .edge,svg .label").style("opacity",.2),d3.selectAll(".arc").style("fill","rgba(150,150,150,1)"),d3.selectAll("#arc"+id).style("fill","rgba(70,70,70,1)"),d3.selectAll("#label"+id).style("opacity",1),d3.selectAll(".e-"+id).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".arc").style("fill","rgba(70,70,70,1)"),d3.selectAll("svg .edge,svg .label").style("opacity",1)}).on("click",function(d){0<=arcFilters.indexOf(parseInt(d.id))?callback(d.id,!1):(-1==d.parent||0<=arcFilters.indexOf(parseInt(d.parent))&&d.level==arcFilters.length)&&callback(d.id,!0)}):(datum=datum.datum(),oldA2=datum.endAngle,oldA1=datum.startAngle),(!nodes[node.id].visible||node.count<=0)&&arcFilters.indexOf(parseInt(node.id))<0&&(node.a2=node.a1),gArcs.select("#arc"+node.id).datum({startAngle:oldA1,endAngle:oldA2,id:node.id,level:level,parent:nodes[node.id].parent}).attr("d",arc).transition().duration(200).attrTween("d",arcTween(node.a1,node.a2,arc)),labelSides[side].push({id:node.id,name:nodes[node.id].name,a1:node.a1,a2:node.a2,radius:radius-10*level,level:node.level,count:node.count,directCount:node.directCount,visible:nodes[node.id].visible}),0<node.children.length){node.multi=getMulti(node.children,node.a1,node.a2,nodes[node.id].directCount);var eID,extraOffset=0;for(eID in node.edges.direct)extraOffset+=node.edges.direct[eID].c*multi;arcGroup(node.a1+extraOffset,multi,node.children,level+1,side)}offset+=gap})}(sides[_side2].start+(biggestSum-sums[_side2])/2*multi+(biggestGap-sideGaps[_side2])*gap/2,multi,structure[_side2],0,_side2),function(side){labelSides[side].sort(function(a,b){return"c_ic"!=side?a.a1-b.a1:b.a2-a.a2});var activeLabels=0;labelSides[side].forEach(function(l){(l.visible&&0<l.count||0<=arcFilters.indexOf(parseInt(l.id)))&&(l.c=activeLabels,activeLabels++)}),labelSides[side].forEach(function(l){var cFont,pp,ppp,label=d3.selectAll("#label"+l.id);l.visible&&0<l.count||0<=arcFilters.indexOf(parseInt(l.id))?(cFont=16-2*l.level,label.empty()&&((label=gLabels[side].append("g").attr("id","label"+l.id).attr("class","label").attr("transform","translate(".concat("c_ic"!=side?width/2-labelWidth+5*l.level:-width/2+labelWidth-5*l.level,",").concat(padding-height/2+(l.c+1)*(height-2*padding)/(activeLabels+1),")"))).append("text").style("font-size",cFont).attr("text-anchor","c_ic"!=side?"start":"end"),label.append("path").style("fill","transparent").style("stroke","rgba(0,0,0,0.2)").style("stroke-dasharray","3 3"),(ppp=label.append("g").attr("transform","translate("+("c_ic"!=side?-14:10)+",-"+cFont/2+")").attr("class","icon").style("display","none")).append("circle").attr("cx",2.5).attr("cy",2.5).attr("r",5),ppp.append("line").attr("x1",0).attr("y1",0).attr("x2",5).attr("y2",5),ppp.append("line").attr("x1",5).attr("y1",0).attr("x2",0).attr("y2",5),label.append("rect").datum({id:l.id}).attr("y",-cFont-1).style("fill","transparent").style("cursor","pointer").attr("height",4+cFont).on("mouseover",function(){var id=d3.select(this).datum().id;d3.selectAll("svg .edge,svg .label").style("opacity",.2),d3.selectAll(".arc").style("fill","rgba(150,150,150,1)"),d3.selectAll("#arc"+id).style("fill","rgba(70,70,70,1)"),d3.selectAll("#label"+id).style("opacity",1),d3.selectAll(".e-"+id).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".arc").style("fill","rgba(70,70,70,1)"),d3.selectAll("svg .edge,svg .label").style("opacity",1)}).on("click",function(){0<=arcFilters.indexOf(parseInt(l.id))?callback(l.id,!1):(-1==nodes[l.id].parent||0<=arcFilters.indexOf(parseInt(nodes[l.id].parent)))&&callback(l.id,!0)})),label.select("text").style("font-weight",0<=arcFilters.indexOf(parseInt(l.id))?"bold":"normal").html("".concat((pp=l.name,ppp=30,pp.length>ppp?pp.substring(0,ppp-3)+"...":pp))),ppp=label.node().getBBox(),label.select("rect").attr("x","c_ic"!=side?-2:-(ppp.width+2)).attr("width",ppp.width+4),pp=polarToCartesian(0<l.a1&&l.a1<Math.PI?l.a1:l.a2,l.radius),ppp=polarToCartesian(0<l.a1&&l.a1<Math.PI?l.a1:l.a2,l.radius+50),label.select("path").transition().duration(200).attr("d","M".concat("c_ic"!=side?-5:5," ").concat(-cFont/2+3,"C").concat("c_ic"!=side?-30:30," ").concat(-cFont/2+3,",").concat(("c_ic"!=side?-width/2+labelWidth+5*l.level:width/2-labelWidth+5*l.level)+ppp[0]," ").concat(height/2-(l.c+1)*height/(activeLabels+1)+ppp[1],",").concat(("c_ic"!=side?-width/2+labelWidth+5*l.level:width/2-labelWidth+5*l.level)+pp[0]," ").concat(height/2-(l.c+1)*height/(activeLabels+1)+pp[1])),label.transition().duration(200).attr("transform","translate(".concat("c_ic"!=side?width/2-labelWidth+5*l.level:-width/2+labelWidth-5*l.level,",").concat(padding-height/2+(l.c+1)*(height-2*padding)/(activeLabels+1),")")),0<=arcFilters.indexOf(parseInt(l.id))?label.select(".icon").style("display","block"):label.select(".icon").style("display","none")):label.empty()||label.classed("noani",!0).transition().duration(500).style("opacity",0).on("end",function(){d3.select(this).remove()})})}(_side2)}for(_side3 in structure)structure[_side3].forEach(function(node){sortEdges(node,"oAll","oKeys","all"),sortEdges(node,"oDirect","oDKeys","direct")});for(_side4 in structure)!function setAngles(_structure,multi){_structure.forEach(function(node){var oOffset=node.a1,dOffset=node.a1;node.edges.oAll.forEach(function(n){n.a1=oOffset,oOffset+=n.c*multi,n.a2=oOffset}),node.edges.oDirect.forEach(function(n){n.a1=dOffset,dOffset+=n.c*multi,n.a2=dOffset}),setAngles(node.children,multi)})}(structure[_side4],multi);!function(){drawn={};for(var id in nodes)!function(id){var node=nodes[id],sNode=walkPath(structure[node.side],node.path,0);0<sNode.count&&sNode.edges.oAll.forEach(function(edge){var line2,a2=id<edge.id?id:edge.id,line1=id>edge.id?id:edge.id,aa2=!0,targetRadius=nodes[edge.id],sourceRadius=walkPath(structure[targetRadius.side],targetRadius.path,0);a2 in drawn||(aa2=!(drawn[a2]={})),line1 in drawn[a2]||(aa2=!(drawn[a2][line1]=!0)),aa2||(a2=line2=!1,line2=sourceRadius.edges.oAll[sourceRadius.edges.oKeys[id]].a1,a2=sourceRadius.edges.oAll[sourceRadius.edges.oKeys[id]].a2,0<=arcFilters.indexOf(parseInt(edge.id))&&(line2=sourceRadius.edges.oDirect[sourceRadius.edges.oDKeys[id]].a1,a2=sourceRadius.edges.oDirect[sourceRadius.edges.oDKeys[id]].a2),line1=sNode.edges.oAll[sNode.edges.oKeys[edge.id]].a1,aa2=sNode.edges.oAll[sNode.edges.oKeys[edge.id]].a2,0<=arcFilters.indexOf(parseInt(id))&&(line1=sNode.edges.oDirect[sNode.edges.oDKeys[edge.id]].a1,aa2=sNode.edges.oDirect[sNode.edges.oDKeys[edge.id]].a2),line2&&a2&&(sourceRadius=radius-10*(targetRadius.path.length-1)-5,targetRadius=radius-10*(node.path.length-1)-5,line1=createConnection(a2,line1,id==edge.id,sourceRadius,targetRadius),line2=createConnection(aa2,line2,id==edge.id,targetRadius,sourceRadius),gEdges.append("path").datum({nodes:[id,edge.id]}).style("fill","rgba(0,0,0,0.5)").style("opacity",0).attr("class","edge "+(line1[4]?"r1 ":"")+(line2[4]?"r2 ":"")+"e-"+id+" e-"+edge.id).attr("d","M "+line1[0][0]+" "+line1[0][1]+" C "+line1[1][0]+" "+line1[1][1]+" "+line1[2][0]+" "+line1[2][1]+" "+line1[3][0]+" "+line1[3][1]+" A "+radius+" "+targetRadius+" 0 0 1 "+line2[0][0]+" "+line2[0][1]+" C "+line2[1][0]+" "+line2[1][1]+" "+line2[2][0]+" "+line2[2][1]+" "+line2[3][0]+" "+line2[3][1]+" A "+radius+" "+sourceRadius+" 0 0 1 "+line1[0][0]+" "+line1[0][1]+"Z").on("mouseover",function(){d3.selectAll(".edge").style("opacity",.2),d3.selectAll("svg .label").style("opacity",.2),d3.select(this).style("opacity",1),d3.selectAll(".arc").style("fill","rgba(150,150,150,1)"),d3.select(this).datum().nodes.forEach(function(n){d3.select("#arc"+n).style("fill","rgba(70,70,70,1)"),d3.select("#label"+n).style("opacity",1)})}).on("mouseout",function(){d3.selectAll("svg .label").style("opacity",1),d3.selectAll(".edge").style("opacity",1),d3.selectAll(".arc").style("fill","rgba(70,70,70,1)")}).on("click",function(){d3.select(this).datum().nodes.forEach(function(n){callback(n,!0)})}).transition().delay(100).duration(100).style("opacity",1)))})}(id)}()},module.update=function(){d3.selectAll(".edge").classed("noani",!0).transition().duration(100).style("opacity",0).on("end",function(){d3.select(this).remove()}),module.draw()};var drawn={};function walkPath(structure,path,level){return path.length-1>level?walkPath(structure[path[level]].children,path,level+1):structure[path[level]]}function createConnection(sourceAngle,targetAngle,same,sRadius,tRadius){var diff,line=[],control=(targetAngle<sourceAngle?(diff=Math.abs(sourceAngle-targetAngle))>Math.PI&&(diff-=2*Math.PI):(diff=Math.abs(sourceAngle-targetAngle))>Math.PI&&(diff=sourceAngle+(2*Math.PI-targetAngle)),Math.PI,(1-Math.sqrt(Math.abs(diff)/Math.PI))*(.99*(sRadius<tRadius?sRadius:tRadius)));return same&&(control=radius-10-30*Math.sqrt(Math.abs(diff)/Math.PI)),line.push(polarToCartesian(sourceAngle,sRadius)),line.push(polarToCartesian(sourceAngle,control)),line.push(polarToCartesian(targetAngle,control)),line.push(polarToCartesian(targetAngle,tRadius)),line.push(!1),line}function polarToCartesian(theta,radius){theta+=Math.PI/180*-90;var returnFloat=[0,0];return returnFloat[0]=radius*Math.cos(theta),returnFloat[1]=radius*Math.sin(theta),returnFloat}return module.bipart=function(_bipart){return bipart=_bipart,module.linkModules(),module},module.reset=function(noUpdate){bipart.reset(),noUpdate||(module.linkModules(),module.update())},module.unFilter=function(id,noUpdate){bipart.unFilter(id),noUpdate||(module.linkModules(),module.update())},module.filter=function(id,noUpdate){bipart.filter(id),noUpdate||(module.linkModules(),module.update())},module.linkModules=function(){module.data(bipart.getStructure(),bipart.getNodes()),module.arcFilters(bipart.getArcFilters()),module.arcEFilters(bipart.getArcEFilters())},module.data=function(_structure,_nodes){return structure=_structure,nodes=_nodes,module},module.gap=function(_gap){return gap=_gap,module},module.sides=function(_sides){return sides=_sides,module},module.width=function(_width){return width=_width,updateRadius(),module},module.height=function(_height){return height=_height,updateRadius(),module},module.arcFilters=function(_arcFilters){return arcFilters=_arcFilters,module},module.arcEFilters=function(_arcEFilters){return arcEFilters=_arcEFilters,module},window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module},translates={journey_station:"journey",inner_change_keywords:"innerchange",sustainability_keywords:"sustainability",perspective_keywords:"perspective"};function reorder(a){var na=[],map={},map1={};a.forEach(function(item){0==item.parent&&(item.children=[],map[item.term_id]=na.length,na.push(item))}),a.forEach(function(item){item.parent in map&&(item.children=[],map1[item.term_id]=[map[item.parent],na[map[item.parent]].children.length],na[map[item.parent]].children.push(item))}),a.forEach(function(item){item.parent in map1&&na[map1[item.parent][0]].children[map1[item.parent][0]].children.push(item)}),na.sort(function(a,b){return a.name-b.name}),na.forEach(function(item){item.children.sort(function(a,b){return a.name-b.name}),item.children.forEach(function(item){item.children.sort(function(a,b){return a.name-b.name})})});var list=[];return na.forEach(function(item){list.push(item),item.children.forEach(function(item){item.name="- "+item.name,list.push(item),item.children.forEach(function(item){item.name="- - "+item.name,list.push(item)})})}),list}for(key in taxonomies){var selectBox=d3.select(".wpcf7-form-control-wrap."+translates[key]+" select");selectBox.selectAll("option").remove(),selectBox.selectAll("option").data(reorder(taxonomies[key])).enter().append("option").attr("value",function(d){return d.name}).html(function(d){return d.name})}function ownKeys(object,enumerableOnly){var symbols,keys=Object.keys(object);return Object.getOwnPropertySymbols&&(symbols=Object.getOwnPropertySymbols(object),enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)),keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var list=function(container,_data,_taxonomy){var tID,key,module={set selection(_selection){selection=_selection,module.update()},set visType(_visType){visType=_visType,module.update()},set sortKey(_sortKey){sortKey=_sortKey},set sortOrder(_sortOrder){sortOrder=_sortOrder},set sortType(_sortType){sortType=_sortType},get selection(){return selection},get sortKey(){return sortKey},get sortOrder(){return sortOrder},get sortType(){return sortType},get filter(){return filter}},container=container,taxonomy=_taxonomy,data=_data,selection={taxonomy:[],type:[]},visType="network",filterdata=[],sortKey="title",sortOrder="asc",sortType="str";for(tID in taxonomy)taxonomy[tID].children=[],0!=taxonomy[tID].parent&&function addChild(parent,child){"children"in taxonomy[parent]||(taxonomy[parent].children=[]);taxonomy[parent].children.push(child);0!=taxonomy[parent].parent&&addChild(taxonomy[parent].parent,child)}(taxonomy[tID].parent,tID);for(key in data)filterdata.push(_objectSpread(_objectSpread({},data[key]),{},{id:key}));var items=container.selectAll("a");return module.update=function(){var _key,selCount=0;for(_key in selection)selCount+=selection[_key].length;var tItems=filterdata.filter(function(d){if("map"==visType&&(0==d.g||"0"==d.g||!d.g))return!1;if(0==selCount)return!0;var _key2,allMatch=!0;for(_key2 in selection)!function(_key2){selection[_key2].forEach(function(f){var matchMade;"bipartite"==visType?0<=d[_key2].indexOf(f)||0<=d[_key2].indexOf(""+f)?d.id:"taxonomy"==_key2?(matchMade=!1,d.id,taxonomy[f].children.forEach(function(c){0<=d[_key2].indexOf(c)&&(matchMade=!0)}),matchMade||(allMatch=!1)):allMatch=!1:"matrix"==visType&&"taxonomy"==_key2?-1==d.root_taxonomy.indexOf(""+f)&&(allMatch=!1):-1==d[_key2].indexOf(f)&&(allMatch=!1)})}(_key2);return!!allMatch}).sort(function(a,b){var ta;return"asc"!=sortOrder&&(ta=a,a=b,b=ta),"str"==sortType?a[sortKey]<b[sortKey]?-1:a[sortKey]>b[sortKey]?1:0:"date"==sortType?new Date(a[sortKey])-new Date(b[sortKey]):a[sortKey]-b[sortKey]});d3.select("#result-display").html(tItems.length+"&nbsp;Results&nbsp;<span>&#8675;</span>"),d3.select("#result-display").classed("updated",!0),setTimeout(function(){d3.select("#result-display").classed("updated",!1)},1e3),(items=items.data(tItems)).exit().remove();tItems=items.enter().append("a");tItems.append("span").attr("class","skytitle"),tItems.append("span").attr("class","title"),tItems.append("span").attr("class","line"),tItems.append("span").attr("class","subline"),tItems.append("hr").attr("class","clear"),(items=tItems.merge(items)).attr("data-type",function(d){return d.type}).attr("data-date",function(d){return d.date}).attr("data-author",function(d){return d.author}).attr("href",function(d){return"https://www.ama-project.org/".concat(d.type,"/").concat(d.slug)}).attr("class",function(d,i){var cl=i+1-3*Math.floor((i+1)/3),cl="type-".concat(d.type," connection list author-").concat(d.author," b").concat(i%2?2:1," c").concat(0==cl?3:cl);return cl+="taxonomy"in d&&null!=d.taxonomy&&0<d.taxonomy.length?" tax-"+d.taxonomy.join(" tax-"):"",cl+="root_taxonomy"in d&&null!=d.root_taxonomy&&0<d.root_taxonomy.length?" root-tax-"+d.taxonomy.join(" root-tax-"):"",cl+=1==d.g?" has-geo":""}),items.select(".skytitle").attr("data-type",function(d){return d.type}).text(function(d){return d.type}),items.select(".title").text(function(d){return"".concat("publication"==d.type||"project"==d.type?"“":"").concat(d.title).concat("publication"==d.type||"project"==d.type?"”":"")}),items.select(".line").html(function(d){var found={sustainability_keywords:{c:0,l:"s"},inner_change_keywords:{c:0,l:"ic"}},fc=0;if("taxonomy"in d&&null!=d.taxonomy&&0<d.taxonomy.length&&d.taxonomy.forEach(function(t){taxonomy[t].taxonomy in found&&(found[taxonomy[t].taxonomy].c++,fc++)}),0==fc)return'<span class="ratioline v-none"></span>';var _key3,_key4,lines=0;for(_key3 in found)0<found[_key3].c&&lines++;if(2==lines)return'<span class="ratioline v-s-50"></span><span class="ratioline v-ic-50"></span>';for(_key4 in found)if(0<found[_key4].c)return'<span class="ratioline v-'.concat(found[_key4].l,'"></span>')}),items.selectAll(".subline").text(function(d){return"sub"in d?d.sub:"-"})},module};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var mapCluster=function(_container,myCustomControl,_taxonomy,_callback){function addParentSelect(skey,item){0==item.parent||item.parent in taxSelectKeys[skey]||(taxSelects[skey].push({name:taxonomy[item.parent].name,value:item.parent,parent:taxonomy[item.parent].parent,has:!1,oHas:!1}),taxSelectKeys[skey][item.parent]=taxSelects[skey].length-1,addParentSelect(skey,taxSelects[skey][taxSelects[skey].length-1]))}function getDepth(id){return 0==taxonomy[id].parent?0:1+getDepth(taxonomy[id].parent)}var popup,module={set selection(_selection){selection=_selection},get selection(){return selection}},taxonomy=_taxonomy,callback=_callback,nodes=myCustomControl,selection=[],mapLoaded=!1,locations=[],taxSelects={sustainability_keywords:[],inner_change_keywords:[],journey_station:[],perspective_keywords:[],ama_role:[]},taxSelectKeys={sustainability_keywords:{},inner_change_keywords:{},journey_tation:{},perspective_keywords:{},ama_role:{}},taxSelectsNodes={sustainability_keywords:null,inner_change_keywords:null,journey_station:null,perspective_keywords:null,ama_role:null},taxSelectsOptions={sustainability_keywords:null,inner_change_keywords:null,journey_station:null,perspective_keywords:null,ama_role:null};nodes.forEach(function(n){n[7].forEach(function(t){var str;t in taxonomy&&taxonomy[t].taxonomy in taxSelectKeys&&!(t in taxSelectKeys[taxonomy[t].taxonomy])&&(taxSelects[taxonomy[t].taxonomy].push({name:(str=taxonomy[t].name).charAt(0).toUpperCase()+str.slice(1),value:t,parent:taxonomy[t].parent,has:!0,oHas:!0}),taxSelectKeys[taxonomy[t].taxonomy][t]=taxSelects[taxonomy[t].taxonomy].length-1)})});for(var skey in taxSelects)!function(skey){taxSelects[skey].forEach(function(s){addParentSelect(skey,taxonomy[s.value])}),taxSelects[skey].sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});var tempList=[];taxSelects[skey].forEach(function(s){0==s.parent&&tempList.push(s)}),taxSelects[skey].sort(function(a,b){return a.name>b.name?-1:a.name<b.name?1:0});for(var i=0;i<tempList.length;i++)!function(i){taxSelects[skey].forEach(function(s){s.parent==tempList[i].value&&(s.name=new Array(getDepth(s.value)+1).join("-")+" "+s.name,tempList.splice(i+1,0,s))})}(i);taxSelects[skey]=tempList,taxSelectsNodes[skey]=d3.select("#select_"+skey),taxSelectsNodes[skey].selectAll("li").remove(),taxSelectsOptions[skey]=taxSelectsNodes[skey].selectAll("li").data(taxSelects[skey]).enter().append("li").append("a").text(function(d){return d.name}).attr("data-value",function(d){return d.value}).classed("disabled",function(d){return!d.has}).on("click",function(d){callback([d.value])})}(skey);module.updateSize=function(){},module.updateSize();var map=new mapboxgl.Map({container:"svg-container",style:{version:8,glyphs:"https://www.ama-project.org/wp-content/themes/ama/assets/map_fonts/{fontstack}/{range}.pbf",sources:{"simple-tiles":{type:"raster",tiles:["https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"],tileSize:256}},layers:[{id:"simple-tiles",type:"raster",source:"simple-tiles",minzoom:0,maxzoom:22,paint:{"raster-opacity":.6}}]},center:[0,0],zoom:1});module.scrollTop=function(){window.scrollTo(0,0),document.body.scrollTop=0},module.tour=new Shepherd.Tour({defaultStepOptions:{showCancelLink:!0}}),module.tour.on("show",module.scrollTop),module.tour.addStep("step-1",{title:"The Map-View",text:"Explore items that have a location attached. The large circle represent clusters of locations. Click on a cluster to zoom in and see more details.",buttons:[{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-2",{title:"The Map-View",text:"Use the zoom buttons for navigation.",attachTo:".mapboxgl-ctrl-top-right left",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3",{title:"The Map-View",text:"Use the taxonomies to filter the locations.",attachTo:{element:"#filter-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-4",{title:"The Map-View",text:"Number of locations shown on the map will update, as you use the filters.",attachTo:"#result-display top",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-4",{title:"The Map-View",text:"The locations shown on the map are also displayed as a list.",attachTo:".connection top",scrollTo:!0,buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]}).on("before-show",module.scrollTop);myCustomControl=new(function(){function MyCustomControl(){_classCallCheck(this,MyCustomControl)}return _createClass(MyCustomControl,[{key:"onAdd",value:function(map){return this.map=map,this.container=document.createElement("div"),this.container.id="map-help-button",this.container.className="map-help-button mapboxgl-ctrl mapboxgl-ctrl-group",this.container.innerHTML='<button class="mapboxgl-ctrl-icon" type="button" title="Help" aria-label="Help">?</button>',this.container.addEventListener("click",function(){module.tour.start()}),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.map=void 0}}]),MyCustomControl}());return map.addControl(new mapboxgl.NavigationControl,"top-right"),map.addControl(myCustomControl,"top-right"),map.scrollZoom.disable(),nodes.forEach(function(n){locations.push({properties:n,type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(n[6]),parseFloat(n[5])]}})}),map.on("load",function(){map.loadImage("https://www.ama-project.org/wp-content/themes/ama/assets/images/institution_map_icon.png",function(error,image){if(error)throw error;map.addImage("institution",image),map.addSource("locations",{type:"geojson",data:{type:"FeatureCollection",features:locations},cluster:!0,clusterMaxZoom:14,clusterRadius:50}),map.addLayer({id:"clusters",type:"circle",source:"locations",filter:["has","point_count"],paint:{"circle-color":"#000000","circle-stroke-color":"#ffffff","circle-stroke-width":2,"circle-radius":["step",["get","point_count"],20,100,30,750,40]}}),map.addLayer({id:"cluster-count",type:"symbol",source:"locations",filter:["has","point_count"],layout:{"text-field":" \n{point_count_abbreviated}","text-font":["Metropolis Regular"],"text-size":13,"text-line-height":.3},paint:{"text-color":"#ffffff"}}),map.addLayer({id:"unclustered-point",type:"symbol",source:"locations",filter:["!",["has","point_count"]],layout:{"icon-image":"institution","icon-size":.25},paint:{}}),map.on("click","clusters",function(clusterId){var features=map.queryRenderedFeatures(clusterId.point,{layers:["clusters"]}),clusterId=features[0].properties.cluster_id;map.getSource("locations").getClusterExpansionZoom(clusterId,function(err,zoom){err||map.easeTo({center:features[0].geometry.coordinates,zoom:zoom})})}),map.on("mouseenter","clusters",function(){map.getCanvas().style.cursor="pointer"}),map.on("mouseleave","clusters",function(){map.getCanvas().style.cursor=""}),map.on("mouseenter","unclustered-point",function(e){map.getCanvas().style.cursor="pointer";for(var coordinates=e.features[0].geometry.coordinates.slice(),bb=e.features[0].properties[1].length<30?e.features[0].properties[1]:e.features[0].properties[1].substr(0,27)+"...",bb1='<svg id="popup-svg" height="150" width="300" style="pointer-events:none;"><defs><filter id="shadow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur in="SourceAlpha" stdDeviation="3" /><feOffset dx="0" dy="0" /><feComponentTransfer><feFuncA type="linear" slope="0.2" /></feComponentTransfer><feMerge><feMergeNode /><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><g transform="translate(20 75)"><rect fill="#fff" height="47" style="filter:url(#shadow)" width="200" /><path d="M0,0L15,0L15,15,L0,0Z" /><line stroke="#000" y1="0" y2="0" x1="-20" /><text id="popup-svg-type" transform="translate(10,0)" text-anchor="'+(e.point.x<window.innerWidth/2?"start":"end")+'" style="fill:#000; font-size:10px; font-family:Arial;" dy="17">Institution</text><text id="popup-svg-text" transform="translate(10,0)" text-anchor="'+(e.point.x<window.innerWidth/2?"start":"end")+'" style="fill:#000; font-size:16px; font-weight:bold; font-family:Arial;" dy="35">'+bb+"</text></g></svg>";180<Math.abs(e.lngLat.lng-coordinates[0]);)coordinates[0]+=e.lngLat.lng>coordinates[0]?360:-360;popup=new mapboxgl.Popup({className:"ama-overview-popup",offset:{left:[7,0],right:[-7,0]},closeButton:!1,closeOnClick:!1,anchor:e.point.x<window.innerWidth/2?"left":"right"}).setLngLat(coordinates).setHTML(bb1).addTo(map);bb=d3.select("#popup-svg-text").node().getBoundingClientRect(),bb1=d3.select("#popup-svg-type").node().getBoundingClientRect();bb1.width>bb.width&&(bb=bb1),d3.select("#popup-svg path").attr("transform","translate("+(e.point.x<window.innerWidth/2?bb.width+5:15)+",0) scale("+(e.point.x<window.innerWidth/2?"1":"-1")+",1)"),d3.select("#popup-svg rect").attr("width",bb.width+20),d3.select("#popup-svg line").attr("x1",e.point.x>window.innerWidth/2?0:-20).attr("x2",e.point.x>window.innerWidth/2?bb.width+40:bb.width+20),d3.selectAll("#popup-svg text").attr("transform","translate("+(e.point.x>window.innerWidth/2?bb.width+10:10)+",0)"),d3.select("#popup-svg g").attr("transform","translate"+(e.point.x>window.innerWidth/2?"("+(300-bb.width-40)+" 75)":"(20 75)"))}),map.on("mouseleave","unclustered-point",function(){map.getCanvas().style.cursor="",popup.remove()}),map.on("click","unclustered-point",function(e){window.location="https://www.ama-project.org/".concat(e.features[0].properties[2],"/").concat(e.features[0].properties[8])}),mapLoaded=!0,module.updateSelection()})}),module.updateSelection=function(){if(locations=[],nodes.forEach(function(n){var hasFeatures=!0;selection&&selection.forEach(function(s){-1==n[7].indexOf(""+s)&&(hasFeatures=!1)}),hasFeatures&&locations.push({properties:n,type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(n[6]),parseFloat(n[5])]}})}),mapLoaded&&map.getSource("locations").setData({type:"FeatureCollection",features:locations}),0<selection.length)for(var _skey in taxSelects)taxSelectsOptions[_skey].each(function(d){0<=selection.indexOf(d.value)?d3.select(this).classed("selected",!0):d3.select(this).classed("selected",!1)})},module.responsive=function(){},module.responsive(),window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module},matrixCircle=function(_container,_list,_nodes,_taxonomy){var width,height,module={set filter(_filter){var changed=_filter!=filter;filter=_filter||"all",changed&&module.update()},get filter(){return filter},set selection(_selection){selection=_selection},get selection(){return selection},set dimensions(_dimensions){dimensions=_dimensions,module.update()},get dimensions(){return dimensions}},nodes=_nodes,taxonomy=_taxonomy,list=_list,container=_container;list.visType="matrix";var key,sdg,t,taxonomyKeys=["objectives","layer","inner_change_keywords","journey_station","perspective_keywords"],taxonomies={},upperTax={},upperTaxKeys={};for(key in taxonomy){taxonomy[key].name.match(/#[0-9]*/)&&(sdg=taxonomy[key].name.match(/#[0-9]*/),taxonomy[key].name=sdg+" "+taxonomy[key].name.replace(/\(SDG #[0-9]*\)/g,"").trim(),taxonomy[key].sdg=sdg[0])}for(t in taxonomyKeys.forEach(function(t){taxonomies[t]={},upperTax[t]=[],upperTaxKeys[t]={},taxonomyKeys.forEach(function(tt){tt!=t&&(taxonomies[t][tt]={keys_1:{},keys_2:{},data:[]})})}),taxonomy)0==taxonomy[t].parent&&0<=taxonomyKeys.indexOf(taxonomy[t].taxonomy)?upperTax[taxonomy[t].taxonomy].push(taxonomy[t]):61==taxonomy[t].parent?upperTax.objectives.push(taxonomy[t]):83==taxonomy[t].parent&&upperTax.layer.push(taxonomy[t]);for(var _t in upperTax)!function(_t){upperTax[_t].sort(function(a,b){return(""+a.name).localeCompare(""+b.name)}),upperTax[_t].forEach(function(tt,tti){upperTaxKeys[_t][tt.id]=tti})}(_t);var _t2,radius;for(_t2 in taxonomies)!function(_t2){for(var tt in taxonomies[_t2])!function(tt){taxonomies[_t2][tt].keys_1=upperTaxKeys[_t2],taxonomies[_t2][tt].keys_2=upperTaxKeys[tt],upperTax[_t2].forEach(function(t1,t1i){var row={id:t1.id,name:t1.name,sdg:t1.sdg,sort:t1i,cols:[]};upperTax[tt].forEach(function(t2,t2i){row.cols.push({id:t2.id,pid:t1.id,name:t2.name,sdg:t2.sdg,sort:t2i,person:{c:0,ids:[]},institution:{c:0,ids:[]},project:{c:0,ids:[]},publication:{c:0,ids:[]},all:{c:0,ids:[]}})}),taxonomies[_t2][tt].data.push(row)})}(tt)}(_t2);nodes.forEach(function(node,n){nodes[n].root_taxonomy.forEach(function(t){nodes[n].root_taxonomy.forEach(function(tt){var t1,tax;t!=tt&&(61==taxonomy[tt].parent||83==taxonomy[tt].parent||0<=taxonomyKeys.indexOf(taxonomy[tt].taxonomy))&&(61==taxonomy[t].parent||83==taxonomy[t].parent||0<=taxonomyKeys.indexOf(taxonomy[t].taxonomy))&&(t1=taxonomy[t].taxonomy,tax=taxonomy[tt].taxonomy,61!=t&&61!=taxonomy[t].parent||(t1="objectives"),61!=tt&&61!=taxonomy[tt].parent||(tax="objectives"),83!=t&&83!=taxonomy[t].parent||(t1="layer"),83!=tt&&83!=taxonomy[tt].parent||(tax="layer"),t1!=tax&&((tax=taxonomies[t1][tax]).data[tax.keys_1[t]].cols[tax.keys_2[tt]].all.c++,tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]].all.ids.push(n),tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]][nodes[n].type].c++,tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]][nodes[n].type].ids.push(n)))})})}),module.updateSize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,400<(radius=width/2-20)&&(radius=400),height=2*radius+40},module.updateSize();var svg=container.append("svg").attr("width",width).attr("height",height).style("overflow","visible"),defs=svg.append("defs");module.tour=new Shepherd.Tour({defaultStepOptions:{showCancelLink:!0}}),module.scrollTop=function(){document.getElementById("matrix-circle-container").scrollIntoView()},module.tour.on("show",module.scrollTop),module.tour.addStep("step-1",{title:"Sustainability — Goals and Layers",text:"This visualisation explores the relationship between sustainability layers and goals.",buttons:[{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-2",{title:"Sustainability — Goals and Layers",text:"Each slice represents one Sustainable-Development-Goal (SDG)",attachTo:".row-label left",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3",{title:"Sustainability — Goals and Layers",text:"Each ring represents one layer from the sustainability taxonomy",attachTo:{element:".col-label:nth-child(3)",on:"bottom"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-5",{title:"Sustainability — Goals and Layers",text:"The grey arcs highlight the number of elements in the AMA database related to IASS. Select an intersection, to see which items can befound between the two categories. For a full matrix of all items in the database, use matrix mode in the explore mode.",attachTo:".vis-box left",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-5",{title:"Sustainability — Goals and Layers",text:"The resulting items are displayed below.",attachTo:"#matrix-circle-list .connection top",scrollTo:!0,buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]});var boxes,boxLabels,boxButtons,helpButton=container.append("button").attr("id","master-help-button").attr("class","inbody").style("left",20).text("?").on("click",function(){module.tour.start()}),s=svg.append("g").attr("transform","translate(".concat(width/2," ").concat(height/2,")")),dimensions=["objectives","layer"],filter="all",selection={taxonomy:[]},bgCircles=s.append("g").selectAll("circle").data(new Array(taxonomies[dimensions[1]][dimensions[0]].data.length+1)).enter().append("circle").attr("cx",0).attr("cy",0).style("fill","transparent").style("stroke","rgba(0,0,0,0.1)"),arc=d3.arc(),scaleR=d3.scaleLinear(),scaleTheTa=d3.scaleLinear(),labelBG=s.append("g").append("path").style("stroke","transparent").style("fill","#fff"),bgDivider=s.append("g").selectAll("line").data(new Array(taxonomies[dimensions[0]][dimensions[1]].data.length+1)).enter().append("line").style("stroke","rgba(0,0,0,0.1)"),boxGroup=s.append("g").attr("id","boxes"),rowTextContainer=s.append("g").attr("id","rowTexts"),colTextContainer=s.append("g").attr("id","colTexts");module.update=function(){scaleR.domain([0,d3.max(taxonomies[dimensions[0]][dimensions[1]].data,function(d){return d3.max(d.cols,function(d){return d[filter].c})})]),scaleTheTa.domain([0,d3.max(taxonomies[dimensions[0]][dimensions[1]].data,function(d){return d3.max(d.cols,function(d){return d[filter].c})})]);var colTexts=defs.selectAll("path.row-path").data(taxonomies[dimensions[0]][dimensions[1]].data);colTexts.enter().append("path").attr("class","row-path").merge(colTexts).attr("id",function(d,i){return"row-path-".concat(i)}),colTexts.exit().remove();var newColTexts=rowTextContainer.selectAll("text.row-label").data(taxonomies[dimensions[0]][dimensions[1]].data),colTexts=newColTexts.enter().append("text").attr("text-anchor","middle");colTexts.append("textPath").attr("xlink:href",function(d,i){return"#row-path-".concat(i)}).attr("text-anchor","middle").attr("startOffset","50%"),colTexts.merge(newColTexts).attr("class",function(d){return"row-label row-label-".concat(d.id)}),rowTextContainer.selectAll("textPath").html(function(d){return d.sdg}),newColTexts.exit().remove();colTexts=rowTextContainer.selectAll("path.row-overlay").data(taxonomies[dimensions[0]][dimensions[1]].data);colTexts.enter().append("path").attr("text-anchor","middle").merge(colTexts).attr("class",function(d){return"row-overlay row-overlay-".concat(d.id)}).style("display","none"),colTexts.exit().remove();newColTexts=rowTextContainer.selectAll("text.row-text-overlay").data(taxonomies[dimensions[0]][dimensions[1]].data);newColTexts.enter().append("text").merge(newColTexts).attr("class",function(d){return"row-text-overlay row-text-overlay-".concat(d.id)}).html(function(d){return d.name}).style("display","none"),newColTexts.exit().remove();colTexts=rowTextContainer.selectAll("path.row-button-overlay").data(taxonomies[dimensions[0]][dimensions[1]].data);colTexts.enter().append("path").merge(colTexts).attr("class",function(d){return"row-button-overlay row-button-overlay-".concat(d.id)}).style("cursor","pointer").style("fill","transparent").on("mouseover",function(d){d3.selectAll(".row-text-overlay-".concat(d.id,", .row-overlay-").concat(d.id)).style("display","block")}).on("mouseout",function(){d3.selectAll(".row-text-overlay, .row-overlay").style("display","none")}),colTexts.exit().remove();newColTexts=defs.selectAll("path.col-path").data(taxonomies[dimensions[0]][dimensions[1]].data[0].cols);newColTexts.enter().append("path").attr("class","col-path").merge(newColTexts).attr("id",function(d,i){return"col-path-".concat(i)}),newColTexts.exit().remove();colTexts=colTextContainer.selectAll("text").data(taxonomies[dimensions[0]][dimensions[1]].data[0].cols),newColTexts=colTexts.enter().append("text").attr("text-anchor","middle");newColTexts.append("textPath").attr("xlink:href",function(d,i){return"#col-path-".concat(i)}).attr("text-anchor","middle").attr("startOffset","50%"),newColTexts.merge(colTexts).attr("class",function(d){return"col-label col-label-".concat(d.id)}),colTextContainer.selectAll("textPath").html(function(d){return d.name.substring(3)}),colTexts.exit().remove(),boxGroup.selectAll("*").remove();var boxData=[];taxonomies[dimensions[0]][dimensions[1]].data.forEach(function(d,di){d.cols.forEach(function(dd,ddi){0<dd[filter].c&&boxData.push({data:dd,x:di,y:ddi})})}),boxes=boxGroup.selectAll("path.vis-box").data(boxData).enter().append("path").attr("class",function(d){return"vis-box vis-box-".concat(d.data.id," vis-box-").concat(d.data.pid)}),boxLabels=boxGroup.selectAll("text").data(boxData).enter().append("text").text(function(d){return d.data[filter].c}).attr("dy",5).attr("text-anchor","middle").attr("class",function(d){return"countLabel countLabel-".concat(d.data.id," countLabel-").concat(d.data.pid)}).style("display","none"),boxButtons=boxGroup.selectAll("path.box-button").data(boxData).enter().append("path").style("fill","transparent").style("cursor","pointer").on("mouseover",function(d){d3.selectAll(".vis-box-".concat(d.data.id,".vis-box-").concat(d.data.pid,":not(.selected)")).style("fill","rgba(0,0,0,0.6)"),d3.selectAll(".countLabel-".concat(d.data.id,".countLabel-").concat(d.data.pid)).style("display","block"),d3.selectAll(".row-label-".concat(d.data.id,",.row-label-").concat(d.data.pid,",.col-label-").concat(d.data.id,",.col-label-").concat(d.data.pid)).style("font-weight","bold")}).on("mouseout",function(){d3.selectAll(".vis-box:not(.selected)").style("fill","rgba(0,0,0,0.3)"),d3.selectAll(".countLabel").style("display","none"),d3.selectAll(".row-label,.col-label").style("font-weight","normal")}).on("click",function(d){d3.selectAll(".vis-box").style("fill","rgba(0,0,0,0.3)").classed("selected",!1),0==selection.taxonomy.length||selection.taxonomy[0]!=d.data.id||selection.taxonomy[1]!=d.data.pid?(selection.taxonomy=[d.data.id,d.data.pid],d3.selectAll(".vis-box-".concat(d.data.id,".vis-box-").concat(d.data.pid)).style("fill","rgba(0,0,0,0.8)").classed("selected",!0)):selection.taxonomy=[],list.selection=selection}),module.responsive()};var thetaOffsetLabel,theta=0,thetaOffset=0,px=function(r,i){return r*Math.cos(i*theta+thetaOffset)},py=function(r,i){return r*Math.sin(i*theta+thetaOffset)};return module.responsive=function(){svg.attr("width",width).attr("height",height),s.attr("transform","translate(".concat(width/2," ").concat(height/2,")")),helpButton.style("top",-1*(height-40-height/16)+"px"),labelBG.attr("d",arc({innerRadius:0,outerRadius:radius+1,startAngle:-Math.PI/180*22.5,endAngle:+Math.PI/180*22.5})),bgCircles.attr("r",function(d,i){return radius/(taxonomies[dimensions[1]][dimensions[0]].data.length+1)*(i+1)}),theta=1.75*Math.PI/taxonomies[dimensions[0]][dimensions[1]].data.length,thetaOffsetLabel=Math.PI/180*22.5,thetaOffset=thetaOffsetLabel-Math.PI/180*90;var innerR=radius/(taxonomies[dimensions[1]][dimensions[0]].data.length+1);bgDivider.attr("x1",function(d,i){return px(radius,i)}).attr("y1",function(d,i){return py(radius,i)}).attr("x2",function(d,i){return px(innerR,i)}).attr("y2",function(d,i){return py(innerR,i)}),scaleR.range([0,innerR]),scaleTheTa.range([0,theta]),boxes.attr("d",function(d){return arc({innerRadius:innerR+innerR*d.y+(innerR-scaleR(d.data[filter].c))/2,outerRadius:innerR+innerR*(d.y+1)-(innerR-scaleR(d.data[filter].c))/2,startAngle:thetaOffsetLabel+d.x*theta+(theta-scaleTheTa(d.data[filter].c))/2,endAngle:thetaOffsetLabel+(d.x+1)*theta-(theta-scaleTheTa(d.data[filter].c))/2})}).style("fill","rgba(0,0,0,0.3)"),boxButtons.attr("d",function(d){return arc({innerRadius:innerR+innerR*d.y,outerRadius:innerR+innerR*(d.y+1),startAngle:thetaOffsetLabel+d.x*theta,endAngle:thetaOffsetLabel+(d.x+1)*theta})}),boxLabels.attr("transform",function(d){return"translate(".concat(px(innerR+innerR*(d.y+.5),d.x+.5),",").concat(py(innerR+innerR*(d.y+.5),d.x+.5),")")}),defs.selectAll("path.row-path").attr("d",function(d,a2){var a1=thetaOffsetLabel+a2*theta,a2=thetaOffsetLabel+(a2+1)*theta;return arc({innerRadius:radius,outerRadius:radius+(a1>.5*Math.PI&&a1<1.5*Math.PI?25:20),startAngle:a1>.5*Math.PI&&a1<1.5*Math.PI?a2:a1,endAngle:a1>.5*Math.PI&&a1<1.5*Math.PI?a1:a2}).split("L")[0]}),defs.selectAll("path.col-path").attr("d",function(d,i){return arc({innerRadius:innerR+innerR*i,outerRadius:innerR+innerR*i+.5*innerR,startAngle:-thetaOffsetLabel,endAngle:thetaOffsetLabel}).split("L")[0]}),rowTextContainer.selectAll("path.row-overlay").attr("d",function(d,i){return arc({innerRadius:innerR,outerRadius:radius,startAngle:thetaOffsetLabel+i*theta,endAngle:thetaOffsetLabel+(i+1)*theta})}).style("fill","rgba(255,255,255,0.75)").style("stroke","transparent").style("display","none"),rowTextContainer.selectAll("path.row-button-overlay").attr("d",function(d,i){return arc({innerRadius:radius,outerRadius:radius+40,startAngle:thetaOffsetLabel+i*theta,endAngle:thetaOffsetLabel+(i+1)*theta})}),rowTextContainer.selectAll("text.row-text-overlay").attr("transform",function(d,i){return"translate(".concat(px((radius-innerR)/2+innerR,i+.5),",").concat(py((radius-innerR)/2+innerR,i+.5),") rotate(").concat((thetaOffsetLabel+theta*(i+.5))/Math.PI*180+90+(thetaOffsetLabel+theta*(i+.5)<Math.PI?180:0),")")}).attr("text-anchor","middle")},module.update(),window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module.svg=function(){return svg},module},matrixRect=function(legend1,_nodes,legend2,s){var width,height,t,module={set filter(_filter){var changed=_filter!=filter;filter=_filter||"all",changed&&module.update()},get filter(){return filter},set selection(_selection){selection=_selection},get selection(){return selection},set dimensions(_dimensions){dimensions=_dimensions,module.update()},get dimensions(){return dimensions}},nodes=_nodes,taxonomy=legend2,callback=s,container=legend1,taxonomyKeys=["objectives","layer","inner_change_keywords","journey_station","perspective_keywords"],taxonomyLabels=["Objectives","Layer","Inner Change","Journey Station","Perspective"],taxonomies={},upperTax={},upperTaxKeys={};for(t in taxonomyKeys.forEach(function(t){taxonomies[t]={},upperTax[t]=[],upperTaxKeys[t]={},taxonomyKeys.forEach(function(tt){tt!=t&&(taxonomies[t][tt]={keys_1:{},keys_2:{},data:[]})})}),taxonomy)0==taxonomy[t].parent&&0<=taxonomyKeys.indexOf(taxonomy[t].taxonomy)?upperTax[taxonomy[t].taxonomy].push(taxonomy[t]):61==taxonomy[t].parent?upperTax.objectives.push(taxonomy[t]):83==taxonomy[t].parent&&upperTax.layer.push(taxonomy[t]);for(var _t in upperTax)!function(_t){upperTax[_t].sort(function(a,b){return(""+a.name).localeCompare(""+b.name)}),upperTax[_t].forEach(function(tt,tti){upperTaxKeys[_t][tt.id]=tti})}(_t);for(var _t2 in taxonomies)!function(_t2){for(var tt in taxonomies[_t2])!function(tt){taxonomies[_t2][tt].keys_1=upperTaxKeys[_t2],taxonomies[_t2][tt].keys_2=upperTaxKeys[tt],upperTax[_t2].forEach(function(t1,t1i){var row={id:t1.id,name:t1.name,sort:t1i,cols:[]};upperTax[tt].forEach(function(t2,t2i){row.cols.push({id:t2.id,pid:t1.id,name:t2.name,sort:t2i,person:{c:0,ids:[]},institution:{c:0,ids:[]},project:{c:0,ids:[]},publication:{c:0,ids:[]},all:{c:0,ids:[]}})}),taxonomies[_t2][tt].data.push(row)})}(tt)}(_t2);for(var n in nodes)!function(n){nodes[n].root_taxonomy.forEach(function(t){nodes[n].root_taxonomy.forEach(function(tt){var t1,tax;t!=tt&&(61==taxonomy[tt].parent||83==taxonomy[tt].parent||0<=taxonomyKeys.indexOf(taxonomy[tt].taxonomy))&&(61==taxonomy[t].parent||83==taxonomy[t].parent||0<=taxonomyKeys.indexOf(taxonomy[t].taxonomy))&&(t1=taxonomy[t].taxonomy,tax=taxonomy[tt].taxonomy,61!=t&&61!=taxonomy[t].parent||(t1="objectives"),61!=tt&&61!=taxonomy[tt].parent||(tax="objectives"),83!=t&&83!=taxonomy[t].parent||(t1="layer"),83!=tt&&83!=taxonomy[tt].parent||(tax="layer"),t1!=tax&&((tax=taxonomies[t1][tax]).data[tax.keys_1[t]].cols[tax.keys_2[tt]].all.c++,tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]].all.ids.push(n),tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]][nodes[n].type].c++,tax.data[tax.keys_1[t]].cols[tax.keys_2[tt]][nodes[n].type].ids.push(n)))})})}(n);module.updateSize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,height=bb.height},module.updateSize();var svg=container.append("svg").attr("width",width).attr("height",height).style("overflow","visible"),gui=container.append("div").attr("id","matrix-gui"),legend2=gui.append("div");legend2.append("div").text("Choose Dimensions");var guiSelect1=legend2.append("select").attr("id","gui-select-1").on("change",function(){dimensions[0]=d3.select(this).property("value"),module.update()}),guiSelect2=legend2.append("select").attr("id","gui-select-2").on("change",function(){dimensions[1]=d3.select(this).property("value"),module.update()}),guiOption1=guiSelect1.selectAll("option").data(taxonomyKeys).enter().append("option").attr("value",function(d){return d}).text(function(d,di){return taxonomyLabels[di]}),guiOption2=guiSelect2.selectAll("option").data(taxonomyKeys).enter().append("option").attr("value",function(d){return d}).text(function(d,di){return taxonomyLabels[di]});module.scrollTop=function(){window.scrollTo(0,0),document.body.scrollTop=0},module.tour=new Shepherd.Tour({defaultStepOptions:{showCancelLink:!0}}),module.tour.on("show",module.scrollTop),module.tour.addStep("step-1",{title:"The Matrix-View",text:"The visualisation shows the relationship between two taxonomies.",buttons:[{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-2",{title:"The Matrix-View",text:"Each rectangle represents the number of items connected to two corresponding categories. Click on a rectangle to explore the resulting items.",attachTo:".click-box bottom",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3",{title:"The Matrix-View",text:"You can use the type filters to narrow down the results to a specific type.",attachTo:{element:"#type-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-4",{title:"The Matrix-View",text:"Use the dropdowns to switch between taxonomies.",attachTo:{element:"#matrix-gui",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-5",{title:"The Matrix-View",text:"The items are displayed as a list below the visualisation.",attachTo:".connection top",scrollTo:!0,buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]}).on("before-show",module.scrollTop),container.append("button").attr("id","master-help-button").text("?").on("click",function(){module.tour.start()});var s=svg.append("g").attr("transform","translate(".concat(20," ").concat(20,")")),dimensions=["layer","inner_change_keywords"],filter="all",selection=!1,legend1=svg.append("g").attr("transform","translate(".concat(140,",").concat(150,")")).style("opacity",.5),legend2=svg.append("g").attr("transform","translate(".concat(150,",").concat(140,")")).style("opacity",.5);legend1.append("text").html("&darr;"),legend2.append("text").html("&rarr;");var legend1Label=legend1.append("text").attr("text-anchor","end").style("font-weight","bold").attr("transform","translate(-5,0)"),legend2Label=legend1.append("text").attr("text-anchor","start").style("font-weight","bold").attr("transform","translate(15,-20) rotate(-45)");module.updateDimensions=function(){guiOption1.attr("disabled",function(d){return dimensions[1]==d?"disabled":null}),guiOption2.attr("disabled",function(d){return dimensions[0]==d?"disabled":null}),guiSelect1.property("value",dimensions[0]),guiSelect2.property("value",dimensions[1]),legend1Label.text(taxonomyLabels[taxonomyKeys.indexOf(dimensions[0])]),legend2Label.text(taxonomyLabels[taxonomyKeys.indexOf(dimensions[1])])};var rowTextContainer=s.append("g").attr("id","rowTexts").attr("transform","translate(0 ".concat(150,")")),colTextContainer=s.append("g").attr("id","colTexts").attr("transform","translate(".concat(150," ").concat(150,")")),boxes=s.append("g").attr("id","boxes").attr("transform","translate(".concat(150," ").concat(150,")")),scaleX=d3.scaleLinear(),scaleY=d3.scaleLinear(),animate=!1;return module.update=function(){var colBoxes=rowTextContainer.selectAll("text").data(taxonomies[dimensions[0]][dimensions[1]].data);colBoxes.enter().append("text").attr("x",150).attr("text-anchor","end").merge(colBoxes).html(function(d){return d.name}).attr("dx",-10).attr("class",function(d){return"row-label row-label-".concat(d.id)}),colBoxes.exit().remove();colBoxes=colTextContainer.selectAll("text").data(taxonomies[dimensions[0]][dimensions[1]].data[0].cols);colBoxes.enter().append("text").merge(colBoxes).html(function(d){return d.name}).attr("text-anchor","start").attr("dx",10).attr("dy",-5).attr("class",function(d){return"col-label col-label-".concat(d.id)}),colBoxes.exit().remove();colBoxes=rowTextContainer.selectAll("line").data(taxonomies[dimensions[0]][dimensions[1]].data);colBoxes.enter().append("line").merge(colBoxes).style("stroke","rgba(0,0,0,0.2)").attr("x1",150),colBoxes.exit().remove();colBoxes=colTextContainer.selectAll("line").data(taxonomies[dimensions[0]][dimensions[1]].data[0].cols);colBoxes.enter().append("line").merge(colBoxes).style("stroke","rgba(0,0,0,0.2)"),colBoxes.exit().remove(),boxes.selectAll("*").remove();colBoxes=boxes.selectAll("g").data(taxonomies[dimensions[0]][dimensions[1]].data).enter().append("g").attr("class","rowBoxes").selectAll("g").data(function(d){return d.cols}).enter().append("g").attr("class","colBoxes");scaleX.domain([0,d3.max(taxonomies[dimensions[0]][dimensions[1]].data,function(d){return d3.max(d.cols,function(d){return d[filter].c})})]),scaleY.domain([0,d3.max(taxonomies[dimensions[0]][dimensions[1]].data,function(d){return d3.max(d.cols,function(d){return d[filter].c})})]),colBoxes.append("rect").attr("class",function(d){return"box box-c-".concat(d.id," box-c-").concat(d.pid)}).style("fill","rgba(0,0,0,0.3)"),colBoxes.append("text").attr("class",function(d){return"text-box box-c-".concat(d.id," box-c-").concat(d.pid)}).text(function(d){return 0<d[filter].c?d[filter].c:""}).attr("dy",4).style("opacity",0).attr("text-anchor","middle").style("font-weight","bold").style("fill","rgba(255,255,255,1)").style("font-size","16px").style("text-shadow","2px 2px 0 #555, 2px -2px 0 #555, -2px 2px 0 #555, -2px -2px 0 #555, 2px 0px 0 #555, 0px 2px 0 #555, -2px 0px 0 #555, 0px -2px 0 #555"),colBoxes.append("rect").attr("class",function(d){return"click-box box-cl-".concat(d.id," box-cl-").concat(d.pid)}).style("fill","rgba(0,0,0,0)").style("cursor","pointer").on("click",function(d){selection&&0<=selection.indexOf(d.id)&&0<=selection.indexOf(d.pid)?callback([]):callback([d.id,d.pid])}).on("mouseover",function(d){d3.selectAll(".box:not(.active)").style("fill","rgba(0,0,0,0.3)"),d3.select(".box.box-c-".concat(d.id,".box-c-").concat(d.pid)).style("fill","rgba(0,0,0,0.6)"),d3.select(".text-box.box-c-".concat(d.id,".box-c-").concat(d.pid)).style("opacity",1),d3.selectAll(".row-label-".concat(d.id,", .row-label-").concat(d.pid,", .col-label-").concat(d.id,", .col-label-").concat(d.pid)).style("font-weight","bold")}).on("mouseout",function(){d3.selectAll(".text-box").style("opacity",0),d3.selectAll(".row-label, .col-label").style("font-weight","normal"),d3.selectAll(".box:not(.active)").style("fill","rgba(0,0,0,0.3)")}),animate=!0,module.responsive()},module.responsive=function(){svg.attr("width",width).attr("height",height);gui.style("top",height-150+"px"),rowTextContainer.selectAll("text").attr("y",function(d,i){return(height-40-150-150)/taxonomies[dimensions[0]][dimensions[1]].data.length*(i+.5)}),colTextContainer.selectAll("text").attr("transform",function(d,i){return"translate(".concat((width-40-150)/taxonomies[dimensions[0]][dimensions[1]].data[0].cols.length*(i+.5)," 0) rotate(-45)")}),rowTextContainer.selectAll("line").attr("y1",function(d,i){return(height-40-150-150)/taxonomies[dimensions[0]][dimensions[1]].data.length*(i+1)}).attr("y2",function(d,i){return(height-40-150-150)/taxonomies[dimensions[0]][dimensions[1]].data.length*(i+1)}).attr("x2",width-40),colTextContainer.selectAll("line").attr("transform",function(d,i){return"translate(".concat((width-40-150)/taxonomies[dimensions[0]][dimensions[1]].data[0].cols.length*(i+1)," 0)")}).attr("y2",height-40-150-150),boxes.selectAll(".rowBoxes").attr("transform",function(d,i){return"translate(0 ".concat((height-40-150-150)/taxonomies[dimensions[0]][dimensions[1]].data.length*i,")")}),boxes.selectAll(".colBoxes").attr("transform",function(d){return"translate(".concat((width-40-150)/taxonomies[dimensions[0]][dimensions[1]].data[0].cols.length*d.sort," 0)")});var boxWidth=(width-40-150)/taxonomies[dimensions[0]][dimensions[1]].data[0].cols.length,boxHeight=(height-40-150-150)/taxonomies[dimensions[0]][dimensions[1]].data.length;scaleX.range([0,boxWidth]),scaleY.range([0,boxHeight]),boxes.selectAll("rect.box").attr("width",0).attr("height",0).attr("x",boxWidth/2).attr("y",boxHeight/2).transition().delay(function(d){return animate?100*d3.select(this.parentNode).datum().sort+100*d.sort:0}).duration(animate?500:0).attr("width",function(d){return scaleX(d[filter].c)}).attr("height",function(d){return scaleY(d[filter].c)}).attr("x",function(d){return(boxWidth-scaleX(d[filter].c))/2}).attr("y",function(d){return(boxHeight-scaleY(d[filter].c))/2}),boxes.selectAll("rect.click-box").attr("width",boxWidth).attr("height",boxHeight).attr("x",0).attr("y",0),boxes.selectAll("text").attr("x",boxWidth/2).attr("y",boxHeight/2),module.updateDimensions(),animate=!1},module.update(),module.updateSelection=function(){d3.selectAll(".box").classed("active",!1),selection&&2==selection.length&&d3.select(".box.box-c-".concat(selection[0],".box-c-").concat(selection[1])).classed("active",!0).style("fill","rgba(0,0,0,0.8)"),d3.selectAll(".box:not(.active)").style("fill","rgba(0,0,0,0.3)")},window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module.svg=function(){return svg},module},networkHome=function(_container,_data,_taxonomy){var width,nodes,edges,edge,module={},data=_data,taxonomy=_taxonomy,nodeMap={},svg=_container,s=svg.append("g");module.updateSize=function(){var bb=svg.node().getBoundingClientRect();width=bb.width},module.init=function(){d3.csv(jspath+"/cache/"+jsppath+"entity-thematic-edges.csv",{headers:{Authorization:"Basic "+btoa("iass:amama2017")}}).then(function(_data){_data.forEach(function(d){d.source!=d.target&&("edges"in data[d.source]||(data[d.source].edges=[]),data[d.source].edges.push(d.target))}),module.construct()}).catch(function(err){throw err})},module.construct=function(){module.updateSize(),nodeMap={},nodes=[],edges=[];var _tkey,taxonomySort=[],taxonomySortKey={};for(_tkey in taxonomy)"journey_station"==taxonomy[_tkey].taxonomy&&taxonomySort.push({name:taxonomy[_tkey].name,key:_tkey});taxonomySort.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),taxonomySort.forEach(function(s,si){taxonomySortKey[s.key]=si}),taxonomySort.forEach(function(tY){tkey=tY.key;var tLength=taxonomySortKey[tkey],tX=width/2+(tLength%2?width/4:-width/4),tY=125+250*tLength;nodes.push({g:s.append("g").datum(nodes.length),tLength:tLength,id:nodes.length-1,oid:tkey,node:!1,origin:!0,type:"taxonomy",title:taxonomy[tkey].name,slug:taxonomy[tkey].slug,x:tX,y:tY,simulation:!1,nodeMap:{},nodes:[],edges:[]});for(var nkey in data)!function(nkey){var hasJourney=!1;0<=data[nkey].taxonomy.indexOf(tkey)&&(hasJourney=!0),hasJourney&&(nodes[nodes.length-1].nodes.push({id:nodes[nodes.length-1].nodes.length-1,oid:nkey,type:data[nkey].type,slug:data[nkey].slug,title:data[nkey].title,randX:10*Math.random()*(.5<Math.random()?-1:1),randY:10*Math.random()*(.5<Math.random()?-1:1),r:5}),"edges"in data[nkey]&&data[nkey].edges.forEach(function(e){edges.push({source:nkey,target:e})}),nodeMap[nkey]=nodes.length-1,nodes[nodes.length-1].nodeMap[nkey]=nodes[nodes.length-1].nodes.length-1)}(nkey);nodes[nodes.length-1].simulation=d3.forceSimulation(nodes[nodes.length-1].nodes).velocityDecay(.2).force("x",d3.forceX().strength(.002)).force("y",d3.forceY().strength(.002)).force("collide",d3.forceCollide().radius(12).iterations(2)),nodes[nodes.length-1].node=nodes[nodes.length-1].g.selectAll("g").data(nodes[nodes.length-1].nodes).enter().append("g").attr("transform",function(d){"translate(".concat(d.x,",").concat(d.y,")")}).on("click",function(d){window.location="https://www.ama-project.org/".concat(d.type,"/").concat(d.slug)}).on("mouseover",function(d){module.updateTooltip(d,nodes[d3.select(d3.select(this).node().parentNode).datum()])}).on("mouseout",function(){tooltip.style("display","none")}),nodes[nodes.length-1].node.append("path").style("stroke","none").attr("d",d3.symbol().size(160).type(function(d){return"institution"==d.type?d3.symbolCross:"person"==d.type?d3.symbolDiamond:"project"==d.type?d3.symbolSquare:"publication"==d.type?d3.symbolTriangle:d3.symbolCircle})).style("fill","#000").style("cursor","pointer")}),edges=edges.filter(function(e){return e.source in nodeMap&&e.target in nodeMap}),edge=s.append("g").selectAll("path").data(edges).enter().append("path").style("stroke","rgba(0,0,0,0.05)").style("fill","transparent").style("pointer-events","none");for(var i=0;i<5;++i)nodes.forEach(function(n){n.simulation.tick()});nodes.forEach(function(n){n.node.attr("transform",function(d){return"translate(".concat(d.x,",").concat(d.y,")")})}),module.updateSize(),module.responsive()},module.redrawEdges=function(){edge.transition().attr("d",function(toy){var tx,ty,ti,tox,sox=nodes[nodeMap[toy.source]].x,soy=nodes[nodeMap[toy.source]].y,sx=sox+nodes[nodeMap[toy.source]].nodes[nodes[nodeMap[toy.source]].nodeMap[toy.source]].x,sy=soy+nodes[nodeMap[toy.source]].nodes[nodes[nodeMap[toy.source]].nodeMap[toy.source]].y,si=Math.floor(sy/250),eox=nodes[nodeMap[toy.target]].x,eoy=nodes[nodeMap[toy.target]].y,ex=eox+nodes[nodeMap[toy.target]].nodes[nodes[nodeMap[toy.target]].nodeMap[toy.target]].x,ey=eoy+nodes[nodeMap[toy.target]].nodes[nodes[nodeMap[toy.target]].nodeMap[toy.target]].y,ei=Math.floor(ey/250),rx=nodes[nodeMap[toy.source]].nodes[nodes[nodeMap[toy.source]].nodeMap[toy.source]].randX,ry=nodes[nodeMap[toy.source]].nodes[nodes[nodeMap[toy.source]].nodeMap[toy.source]].randY;if(si==ei||1==Math.abs(si-ei))return"M".concat(sx," ").concat(sy,"C").concat(sox," ").concat(soy,",").concat(eox," ").concat(eoy,",").concat(ex," ").concat(ey);ei<si&&(tx=sx,ty=sy,ti=si,tox=sox,toy=soy,sx=ex,sy=ey,si=ei,sox=eox,soy=eoy,ex=tx,ey=ty,ei=ti,eoy=toy,eox=tox);for(var path="M".concat(sx," ").concat(sy,"C").concat(sox+rx," ").concat(soy+ry,",").concat(sox+rx," ").concat(soy+ry,",").concat(sox+rx+.5*(nodes[si+1].x-sox)," ").concat(soy+ry+.5*(nodes[si+1].y-soy)),i=si+1;i<ei;i++)path+="C".concat(nodes[i].x+rx," ").concat(nodes[i].y+ry,",").concat(nodes[i].x+rx," ").concat(nodes[i].y+ry,",").concat(nodes[i].x+rx+.5*(nodes[i+1].x-nodes[i].x)," ").concat(nodes[i].y+ry+.5*(nodes[i+1].y-nodes[i].y));return path+="C".concat(eox+rx," ").concat(eoy+ry,",").concat(eox+rx," ").concat(eoy+ry,",").concat(ex," ").concat(ey)})};var tooltip=svg.append("g").style("display","none").style("pointer-events","none"),tooltipBg=tooltip.append("path").style("fill","#000").style("stroke","#000").style("stroke-width",5).style("stroke-linejoin","round"),tooltipText=tooltip.append("text").style("fill","#fff").attr("dy",4);return module.updateTooltip=function(dir,parent){tooltip.attr("transform","translate(".concat(parent.x+dir.x+(parent.x+dir.x<width/2?15:-15),",").concat(parent.y+dir.y,")")),tooltipText.text(dir.title.length<30?dir.title:dir.title.substr(0,27)+"...").attr("text-anchor",parent.x+dir.x<width/2?"start":"end").attr("dx",parent.x+dir.x<width/2?"20":"-20");var bb=tooltipText.node().getBoundingClientRect(),dir=parent.x+dir.x<width/2?1:-1;tooltipBg.attr("d","M0,0L".concat(15*dir,",15L").concat((15+bb.width+15)*dir,",15L").concat((15+bb.width+15)*dir,",-15L").concat(15*dir,",-15Z")),tooltip.style("display","block")},module.responsive=function(){nodes.forEach(function(n){n.x=n.tLength%2?.25*width:.75*width,n.g.attr("transform","translate(".concat(n.x,",").concat(n.y,")"))}),module.redrawEdges()},window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module},networkOverallThematic=function(_container,_data,_taxonomy,_id,_callback,_taxLimit,_individual){var width,height,rScale,module={set filterType(_filter){module.applyFilter("type",_filter,!0)},get filterType(){return filters.type},set selection(_selection){selection=_selection},get selection(){return selection}},taxLimit=_taxLimit||!1,id=_id,individual=_individual||!1,data=_data,taxonomy=_taxonomy,callback=_callback,container=_container,simulation=d3.forceSimulation().force("charge",d3.forceManyBody()).force("link",d3.forceLink().id(function(d){return d.id})).force("center",d3.forceCenter(0,0)).force("collide",d3.forceCollide(function(d){return d.r+20})),taxSelects={sustainability_keywords:[],inner_change_keywords:[],journey_station:[],perspective_keywords:[],ama_role:[]},taxSelectKeys={sustainability_keywords:{},inner_change_keywords:{},journey_station:{},perspective_keywords:{},ama_role:{}},taxSelectsNodes={sustainability_keywords:null,inner_change_keywords:null,journey_station:null,perspective_keywords:null,ama_role:null},taxSelectsOptions={sustainability_keywords:null,inner_change_keywords:null,journey_station:null,perspective_keywords:null,ama_role:null};module.updateSize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,height=bb.height},module.updateSize();var svg=container.append("svg").attr("width",width).attr("height",height);module.scrollTop=function(){window.scrollTo(0,0),document.body.scrollTop=0},module.tour=new Shepherd.Tour({defaultStepOptions:{showCancelLink:!0}}),module.tour.on("show",module.scrollTop),module.tour.addStep("step-1",{title:"The Network-View",text:"The visualisation shows which items are connected to which categories.",buttons:[{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-2",{title:"The Network-View",text:"The circles represent the taxonomies. Sustainability in red, inner change in green. The bigger the circle, the more items are connected. Select a circle to filter items.",attachTo:".node-sustainability_keywords top",buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3",{title:"The Network-View",text:"Hover over an icon to learn more and click the icon to continue to its details page.",attachTo:{element:".node-unknown",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-3-1",{title:"The Matrix-View",text:"You can use the type filters to narrow down the results to a specific type.",attachTo:{element:"#type-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),1<=d3.selectAll("#explore-con").size()?(module.tour.addStep("step-3-2",{title:"The Matrix-View",text:"You can use the taxonomy filters to narrow down the results to specific categories.",attachTo:{element:"#filter-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-4",{title:"The Network-View",text:"Selecting taxonomies act as filters. The number of resulting items is displayed below.",attachTo:{element:"#result-display",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.next,text:"Next &raquo;"}]}).on("before-show",module.scrollTop),module.tour.addStep("step-5",{title:"The Network-View",text:"All filtered items are displayed as a list below the visualisation.",attachTo:"a.connection top",scrollTo:!0,buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]}).on("before-show",module.scrollTop)):module.tour.addStep("step-3-2",{title:"The Matrix-View",text:"You can use the taxonomy filters to narrow down the results to specific categories.",attachTo:{element:"#filter-nav",on:"top"},buttons:[{action:module.tour.back,classes:"shepherd-button-secondary",text:"&laquo; Back"},{action:module.tour.cancel,text:"Exit &times;"}]}).on("before-show",module.scrollTop),1<=d3.selectAll("body.page-template-explore, body.single").size()&&container.append("button").attr("id","master-help-button").text("?").on("click",function(){module.tour.start()}),svg.append("defs").append("filter").attr("id","shadow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%").html('<feGaussianBlur in="SourceAlpha" stdDeviation="3" /><feOffset dx="0" dy="0" /><feComponentTransfer><feFuncA type="linear" slope="0.2" /></feComponentTransfer><feMerge><feMergeNode /><feMergeNode in="SourceGraphic"/></feMerge>');var dragX=width/2,dragY=height/2;svg.append("rect").attr("width",width).attr("height",height).attr("fill","transparent").call(d3.drag().on("drag",function(){s.attr("transform","translate(".concat(dragX+d3.event.x-d3.event.subject.x,",").concat(dragY+d3.event.y-d3.event.subject.y,")"))}).on("end",function(){dragX=dragX+d3.event.x-d3.event.subject.x,dragY=dragY+d3.event.y-d3.event.subject.y}));var nodeSel,s=svg.append("g"),nodes=[],nodeKeys={tax:{},el:{}},edges=[],filters={taxonomy:[],type:[]},selection=[];module.resetSelection=function(){selection=[]},module.setSelection=function(id){var i;id&&(-1==(i=selection.indexOf(id))?selection.push(id):selection.splice(i,1))},module.updateSelection=function(){var skey,nodeIDs=[],taxIDs=[];for(skey in 0<selection.length?(icons.style("fill",function(d){return"taxonomy"==d.type?"sustainability_keywords"==d.tax?"rgb(181, 128, 150)":"rgb(124, 161, 162)":individual&&d.oid==id?"transparent":"#999"}).style("stroke","transparent"),nodeSel=d3.selectAll(".node.taxonomy-"+selection.join(" path, .node.taxonomy-")+" path, .node.tax-"+selection.join(".tax-")+" path").style("fill",function(d){return"taxonomy"==d.type?"sustainability_keywords"==d.tax?"#761B41":"#0D6B6F":individual&&d.oid==id?"transparent":"#000"}).each(function(d){("taxonomy"!=d.type?nodeIDs:taxIDs).push(d.oid)}),d3.selectAll(".node.child-"+nodeIDs.join(" path, .node.child-")+" path").style("fill",function(d){return"taxonomy"==d.type?(taxIDs.push(d.oid),"sustainability_keywords"==d.tax?"#761B41":"#0D6B6F"):individual&&d.oid==id?"transparent":"#000"}),d3.selectAll(".node.taxonomy-"+selection.join(" path, .node.taxonomy-")+" path").style("stroke","#000").style("stroke-width",2),d3.selectAll(".connection").style("stroke-opacity",.05),module.highlightSelection()):(icons.style("fill",function(d){return"taxonomy"==d.type?"sustainability_keywords"==d.tax?"#761B41":"#0D6B6F":individual&&d.oid==id?"transparent":"#000"}).style("stroke","transparent"),d3.selectAll(".connection").style("stroke-opacity",.2)),taxSelects)taxSelects[skey].forEach(function(tax){0==selection.length?tax.has=tax.oHas:0<=taxIDs.indexOf(tax.value)?tax.has=!!tax.oHas:tax.has=!1});module.updateSelects()},module.applyFilter=function(type,value,set){var change=!1,i=filters[type].indexOf(value);set?-1==i&&(filters[type].push(value),change=!0):0<=i&&(filters[type].splice(i,1),change=!0),change&&(module.buildNetwork(),module.updateSimulation(!0))},module.resetFilter=function(update){filters={taxonomy:[],type:[]},update&&(module.buildNetwork(),module.updateSimulation(!0))};var firstUpper=function(str){return str.charAt(0).toUpperCase()+str.slice(1)};module.buildNetwork=function(){var oNodes=nodes,oNodeKeys=nodeKeys;nodes=[],nodeKeys={tax:{},el:{}},edges=[],selection=[],taxSelects={sustainability_keywords:[],inner_change_keywords:[],journey_station:[],perspective_keywords:[],ama_role:[]},taxSelectKeys={sustainability_keywords:{},inner_change_keywords:{},journey_station:{},perspective_keywords:{},ama_role:{}};for(var key in data)!function(key){var hasConnection,inTypeFilter,inTaxFilter;"title"in data[key]&&0<data[key].taxonomy.length&&(hasConnection=!1,data[key].taxonomy.forEach(function(t){"sustainability_keywords"!=taxonomy[t].taxonomy&&"inner_change_keywords"!=taxonomy[t].taxonomy||(hasConnection=!0)}),inTaxFilter=inTypeFilter=!0,0<filters.taxonomy.length&&(inTaxFilter=!1,data[key].taxonomy.forEach(function(t){0<=filters.taxonomy.indexOf(t)&&(inTaxFilter=!0)})),0<filters.type.length&&(inTypeFilter=!1,0<=filters.type.indexOf(data[key].type)&&(inTypeFilter=!0)),(hasConnection&&inTypeFilter&&inTaxFilter||individual&&key==id)&&(nodes.push({id:data[key].type+"-"+key,oid:key,type:data[key].type,title:firstUpper(data[key].title),taxonomy:data[key].taxonomy,slug:data[key].slug,r:10,x:key in oNodeKeys.el?oNodes[oNodeKeys.el[key]].x:0,y:key in oNodeKeys.el?oNodes[oNodeKeys.el[key]].y:0,c:1}),nodeKeys.el[key]=nodes.length-1,data[key].taxonomy.forEach(function(t){var ico;"sustainability_keywords"!=taxonomy[t].taxonomy&&"inner_change_keywords"!=taxonomy[t].taxonomy&&"journey_station"!=taxonomy[t].taxonomy&&"ama_role"!=taxonomy[t].taxonomy&&"perspective_keywords"!=taxonomy[t].taxonomy||(t in nodeKeys.tax||(ico=[],taxonomy[t].direct.forEach(function(dc){dc in data&&data[dc].taxonomy.forEach(function(dct){-1==ico.indexOf(dct)&&ico.push(dct)})}),(!individual||-1<taxLimit.indexOf(t))&&(taxSelects[taxonomy[t].taxonomy].push({name:firstUpper(taxonomy[t].name),value:t,parent:taxonomy[t].parent,has:!0,oHas:!0}),taxSelectKeys[taxonomy[t].taxonomy][t]=taxSelects[taxonomy[t].taxonomy].length-1),(!taxLimit||-1<taxLimit.indexOf(t))&&(nodes.push({id:"taxonomy-"+t,oid:t,type:"taxonomy",tax:taxonomy[t].taxonomy,title:firstUpper(taxonomy[t].name),r:10,x:t in oNodeKeys.tax?oNodes[oNodeKeys.tax[t]].x:0,y:t in oNodeKeys.tax?oNodes[oNodeKeys.tax[t]].y:0,ico:ico,c:0}),nodeKeys.tax[t]=nodes.length-1)),(!taxLimit||-1<taxLimit.indexOf(t))&&(nodes[nodeKeys.tax[t]].c++,edges.push({source:nodes[nodeKeys.el[key]].id,target:nodes[nodeKeys.tax[t]].id})))})))}(key);rScale=individual?d3.scaleLinear().range([.5,5]).domain([1,taxLimit.length]):d3.scaleLinear().range([1,10]).domain([1,d3.max(nodes,function(d){return d.c})]),nodes.forEach(function(n,ni){var ct;individual?"taxonomy"==nodes[ni].type?nodes[ni].r=2.5:id==nodes[ni].oid?nodes[ni].r=50:(ct=0,nodes[ni].taxonomy.forEach(function(t){-1<taxLimit.indexOf(t)&&ct++}),nodes[ni].r=rScale(ct)):nodes[ni].r=rScale(nodes[ni].c)});for(var skey in taxSelects)!function(skey){taxSelects[skey].forEach(function(s){addParentSelect(skey,taxonomy[s.value])}),taxSelects[skey].sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});var tempList=[];taxSelects[skey].forEach(function(s){0==s.parent&&tempList.push(s)}),taxSelects[skey].sort(function(a,b){return a.name>b.name?-1:a.name<b.name?1:0});for(var i=0;i<tempList.length;i++)!function(i){taxSelects[skey].forEach(function(s){s.parent==tempList[i].value&&(s.name=new Array(getDepth(s.value)+1).join("-")+" "+s.name,tempList.splice(i+1,0,s))})}(i);taxSelects[skey]=tempList,taxSelectsNodes[skey]=d3.select("#select_"+skey),taxSelectsNodes[skey].selectAll("li").remove(),taxSelectsOptions[skey]=taxSelectsNodes[skey].selectAll("li").data(taxSelects[skey]).enter().append("li").append("a").text(function(d){return d.name}).attr("data-value",function(d){return d.value}).classed("disabled",function(d){return!d.has}).on("click",function(d){module.setSelection(d.value),callback(selection)})}(skey)},module.updateSelects=function(){for(var skey in taxSelects)taxSelectsOptions[skey].data(taxSelects[skey]).each(function(d){0<=selection.indexOf(d.value)?d3.select(this).classed("selected",!0):d3.select(this).classed("selected",!1),d.has?d3.select(this).classed("disabled",!1):d3.select(this).classed("disabled",!0)})};var icons,getDepth=function getDepth(id){return 0==taxonomy[id].parent?0:1+getDepth(taxonomy[id].parent)},addParentSelect=function addParentSelect(skey,item){0==item.parent||item.parent in taxSelectKeys[skey]||(taxSelects[skey].push({name:taxonomy[item.parent].name,value:item.parent,parent:taxonomy[item.parent].parent,has:!1,oHas:!1}),taxSelectKeys[skey][item.parent]=taxSelects[skey].length-1,addParentSelect(skey,taxSelects[skey][taxSelects[skey].length-1]))},ticked=function(){node.attr("transform",function(y){var x=y.x=Math.max(y.r+20-width/2,Math.min(width/2-(y.r+20),y.x)),y=y.y=Math.max(y.r+20-height/2,Math.min(height/2-(y.r+20),y.y));return"translate(".concat(x,",").concat(y,")")}),link.attr("x1",function(d){return d.source.x}).attr("y1",function(d){return d.source.y}).attr("x2",function(d){return d.target.x}).attr("y2",function(d){return d.target.y})},link=s.append("g").attr("stroke-width",1).attr("stroke","#000").attr("stroke-opacity",.2).style("pointer-events","none").selectAll("line"),node=s.append("g").selectAll("g");module.updateSimulation=function(item){if(individual&&nodes.sort(function(a,b){return a.oid==id?1:0}),simulation.nodes(nodes).on("tick",ticked),simulation.force("link").links(edges),item)simulation.alpha(1).restart();else for(var i=0;i<80;++i)simulation.tick();var itembg,itemTextSize;(link=link.data(edges)).exit().remove(),(link=link.enter().append("line").merge(link)).attr("class",function(d){var cl="connection";return["source","target"].forEach(function(t){cl+=" "+d[t].type+"-"+d[t].oid,"taxonomy"!=d[t].type&&d[t].taxonomy.forEach(function(tax){cl+=" ico-"+tax})}),cl.trim()}),(node=node.data(nodes,function(d){return d.id})).exit().remove(),(node=node.enter().append("g").merge(node)).attr("class",function(d){var cl="node "+d.type+"-"+d.oid;return"taxonomy"in d&&d.taxonomy.forEach(function(t){cl+=" tax-"+t}),"taxonomy"==d.type&&taxonomy[d.oid].direct.forEach(function(c){cl+=" child-"+c}),"ico"in d&&d.ico.forEach(function(t){cl+=" ico-"+t}),cl.trim()}),node.selectAll("path").remove(),icons=node.append("path").style("stroke","none").attr("d",d3.symbol().size(function(d){return 100*d.r}).type(function(d){return"taxonomy"==d.type?d3.symbolCircle:"institution"==d.type?d3.symbolCross:"person"==d.type?d3.symbolDiamond:"project"==d.type?d3.symbolSquare:"publication"==d.type?d3.symbolTriangle:d3.symbolCircle})).style("fill",function(d){return"taxonomy"==d.type?"sustainability_keywords"==d.tax?"#761B41":"#0D6B6F":"#000"}).attr("class",function(d){return"taxonomy"==d.type?"node-"+d.tax:individual&&d.oid==id?"node-individual":"node-unknown"}).style("cursor","pointer").on("click",function(d){"taxonomy"==d.type?(module.setSelection(d.oid),callback(selection)):window.location="https://www.ama-project.org/".concat(d.type,"/").concat(d.slug)}).on("mouseover",function(d){d3.selectAll(".".concat(d.type,"-").concat(d.oid)).style("stroke-opacity",1),module.updateTooltip(d)}).on("mouseout",function(){tooltip.style("display","none"),0<selection.length?(d3.selectAll(".connection").style("stroke-opacity",.05),module.highlightSelection()):d3.selectAll(".connection").style("stroke-opacity",.2)}),individual&&(itemTextSize=(itembg=d3.select(".node.".concat(data[id].type,"-").concat(id))).datum(),(item=itembg.append("g")).append("circle").attr("r",40).attr("fill","#f9f9f9").attr("stroke","#000").attr("stroke-width","2px;"),item.append("image").attr("width",80).attr("height",80).attr("x",-40).attr("y",-40).attr("xlink:href",jspath+"/assets/images/icon_"+itemTextSize.type+"s@2x.png"),itembg=item.append("g"),itemTextSize=item.append("g").attr("transform","translate(0,43)").append("text").attr("style","fill:#fff; font-size:15px; font-style:italic;").text(itemTextSize.title.length<30?itemTextSize.title:itemTextSize.title.substr(0,27)+"...").attr("text-anchor","middle").node().getBoundingClientRect(),itembg.append("rect").attr("x",itemTextSize.width/-2-8).attr("y",27).attr("width",itemTextSize.width+16).attr("height",24).attr("fill","#000"))},module.highlightSelection=function(){var sel;0<selection.length&&(sel="",nodeSel.each(function(d){"taxonomy"!=d.type&&(""!=sel&&(sel+=","),sel+=" .connection."+d.type+"-"+d.oid)}),""!=sel&&d3.selectAll(sel).style("stroke-opacity",.3)),1==selection.length?d3.selectAll(".connection.taxonomy-"+selection[0]).style("stroke-opacity",1):selection.length};var tooltip=s.append("g").style("display","none").style("pointer-events","none"),tooltipBg=tooltip.append("rect").style("fill","#fff").attr("height",47).style("filter","url(#shadow)"),tooltipTri=tooltip.append("path").attr("d","M0,0L15,0L15,15,L0,0Z"),tooltipLine=tooltip.append("line").attr("y1",0).attr("y2",0).attr("x1",-20),tooltipType=tooltip.append("text").style("fill","#000").attr("dy",17).style("font-size","10px").style("font-family","Arial").style("text-transform","capitalize"),tooltipText=tooltip.append("text").style("fill","#000").attr("dy",35).style("font-size","16px").style("font-family","Arial").style("font-weight","bold");return module.updateTooltip=function(d){var bb1="#000";"taxonomy"==d.type&&(bb1="sustainability_keywords"==d.tax?"#761B41":"#0D6B6F"),tooltipLine.attr("stroke",bb1),tooltipTri.attr("fill",bb1),tooltip.attr("transform","translate(".concat(d.x+(d.x<0?20:-20),",").concat(d.y,")"));tooltipType.text("taxonomy"==d.type?{sustainability_keywords:"Sustainablity",inner_change_keywords:"Inner Change",journey_station:"Journey Stations",ama_role:"AMA Roles",perspective_keywords:"Perspective"}[d.tax]:d.type).attr("text-anchor",d.x<0?"start":"end").attr("dx",d.x<0?"10":"-10"),tooltip.style("display","block"),tooltipText.text(d.title.length<30?d.title:d.title.substr(0,27)+"...").attr("text-anchor",d.x<0?"start":"end").attr("dx",d.x<0?"10":"-10");var bb=tooltipText.node().getBoundingClientRect(),bb1=tooltipType.node().getBoundingClientRect();bb1.width>bb.width&&(bb=bb1),tooltipBg.attr("width",bb.width+20).attr("transform",d.x<0?"":"translate(".concat(-(bb.width+20),",0)")),tooltipTri.attr("transform","translate(".concat(d.x<0?bb.width+5:-(bb.width+5),",0) scale(").concat(d.x<0?1:-1,",1)")),tooltipLine.attr("x1",d.x<0?-20:20).attr("x2",d.x<0?bb.width+20:-(bb.width+20))},module.responsive=function(){svg.attr("width",width).attr("height",height),s.attr("transform","translate(".concat(width/2,",").concat(height/2,")"))},module.responsive(),window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module.buildNetwork(),module.updateSimulation(!1),module.svg=function(){return svg},module},preloader=function(label){var width,height,module={},container=label,svg=d3.select("#container").append("svg");module.resize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,height=bb.height},module.responsive=function(){svg.attr("width",width).attr("height",height)},module.resize(),module.responsive(),window.addEventListener("resize",debounce(function(){module.resize(),module.responsive()}));var links,onodes=[{x:0,y:0,id:1,fx:0,fy:0,fixed:!0}],nodes=onodes,olinks=[],simulation=d3.forceSimulation(nodes).force("charge",d3.forceManyBody()).force("link",d3.forceLink().id(function(d){return d.id})).force("center",d3.forceCenter(0,0)).force("collide",d3.forceCollide(10)).on("tick",function(){node.attr("cx",function(d){return d.x}).attr("cy",function(d){return d.y}),link.attr("x1",function(d){return d.source.x}).attr("y1",function(d){return d.source.y}).attr("x2",function(d){return d.target.x}).attr("y2",function(d){return d.target.y})}),g=svg.append("g").attr("transform","translate("+width/2+","+height/2+")"),link=g.append("g").attr("stroke","rgba(0,0,0,0.2)").attr("stroke-width",1).selectAll(".link"),node=g.append("g").attr("stroke","rgba(255,255,255,0.5)").attr("stroke-width",.5).selectAll(".node"),label=g.append("g").attr("transform","translate(0,40)"),labelBg=label.append("rect").attr("height",19).attr("fill","#000").style("opacity",.6).attr("stroke","#000").attr("stroke-width",8).style("stroke-linejoin","round"),labelText=label.append("text").attr("fill","#fff").attr("dy",14).text("Loading Network").style("font-style","italic").attr("text-anchor","middle");g.append("g").append("circle").attr("r",5).attr("stroke-width",1).attr("stroke","rgba(255,255,255,1)").attr("fill","#000"),module.updateLabel=function(b){b=labelText.text(b).node().getBoundingClientRect();labelBg.attr("width",b.width+10).attr("x",b.width/-2-5)},module.updateLabel("Loading Network");var interval=d3.interval(function(){nodes.forEach(function(n,ni){onodes[ni].x=n.x,onodes[ni].y=n.y,onodes[ni].fx=n.fx,onodes[ni].fy=n.fy}),onodes.push({x:0,y:0,id:onodes.length+1}),nodes=JSON.parse(JSON.stringify(onodes));for(var cons=Math.ceil(Math.random()*Math.min(nodes.length-1,3)),cIDs=[];cIDs.length<cons;){var cID=1+Math.round(Math.random()*(nodes.length-1));-1==cIDs.indexOf(cID)&&cID!=nodes.length&&cIDs.push(cID)}cIDs.forEach(function(c){olinks.push({source:onodes.length,target:c})}),links=JSON.parse(JSON.stringify(olinks)),simulation.nodes(nodes).force("link",d3.forceLink(links).id(function(d){return d.id})).alpha(1).restart(),(node=node.data(nodes,function(d){return d.id})).exit().remove(),node=node.enter().append("circle").attr("fill",function(d){return"fixed"in d?"#000":"#555"}).attr("r",function(d){return"fixed"in d?5:3}).merge(node),(link=link.data(links)).exit().remove(),link=link.enter().append("line").merge(link)},1e3,d3.now());return module.stop=function(){interval.stop()},module.restart=function(){interval.restart()},module},rings=function(itembg,_data,itemTextSize,_id){var width,height,module={},data=_data,id=_id,container=itembg,taxonomy=itemTextSize;module.polarX=function(d){return d[1]*Math.cos(d[0])},module.polarY=function(d){return d[1]*Math.sin(d[0])};var line=d3.line().curve(d3.curveCatmullRom).x(module.polarX).y(module.polarY);module.updateSize=function(){var bb=container.node().getBoundingClientRect();width=bb.width,height=bb.height},module.updateSize();itembg=container.append("svg").attr("width",width).attr("height",height);itembg.append("defs").append("filter").attr("id","shadow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%").html('<feGaussianBlur in="SourceAlpha" stdDeviation="3" /><feOffset dx="0" dy="0" /><feComponentTransfer><feFuncA type="linear" slope="0.2" /></feComponentTransfer><feMerge><feMergeNode /><feMergeNode in="SourceGraphic"/></feMerge>');var simScale=d3.scaleLinear().domain([1,data.taxonomy.length]).range([32,256]),hitScale=d3.scaleLinear().domain([1,data.taxonomy.length]).range([4,8]),s=itembg.append("g"),rings={sustainability_keywords:[],inner_change_keywords:[]},ringKeys={sustainability_keywords:{},inner_change_keywords:{}},ringCount=0;data.taxonomy.forEach(function(t){taxonomy[t].taxonomy in rings&&(rings[taxonomy[t].taxonomy].push([t,0,[]]),ringKeys[taxonomy[t].taxonomy][t]=rings[taxonomy[t].taxonomy].length-1,ringCount++)}),data["thematic-direct-direct"].forEach(function(t){t[3]in rings&&0==t[2]&&t[0]!=id&&(rings[t[3]][ringKeys[t[3]][t[1]]][2].push(t[0]),rings[t[3]][ringKeys[t[3]][t[1]]][1]++)});var configs={sustainability_keywords:{r:300,g:null,p:[],pI:[],c:"#761B41",ac:0,o:175},inner_change_keywords:{r:150,g:null,p:[],pI:[],c:"#0D6B6F",ac:0,o:100}};module.rotate=function(a,angle){return a.forEach(function(d,i){a[i][0]=module.rotateA(d[0],angle)}),a},module.rotateA=function(item,angle){return item+=angle,angle>2*Math.PI&&(angle-=2*Math.PI),angle<0&&(angle+=2*Math.PI),item};var key,maxs=[];for(key in rings)maxs.push(d3.max(rings[key],function(d){return d[1]}));for(var ringScale=d3.scaleLinear().domain([0,d3.max(maxs)]).range([5,50]),ringStep=2*Math.PI/ringCount,ir=0,r=0;r<ringCount;r++)for(var _key in rings){var n=Math.round(r/ringCount*rings[_key].length);n>=configs[_key].ac&&n<rings[_key].length&&(rings[_key][configs[_key].ac].push(ir*ringStep),ir++,configs[_key].ac++)}var simNodes=[],simNodeKeys={};function jigger(a,d){return a.forEach(function(el,i){a[i][1]+=d*Math.random()}),a}for(var _key2 in rings)!function(_key2){if(configs[_key2].g=s.append("g"),0==rings[_key2].length?configs[_key2].g.append("circle").attr("r",configs[_key2].r):1==rings[_key2].length?(rings[_key2][0].push(0),configs[_key2].p.push([rings[_key2][0][3],configs[_key2].r+50]),configs[_key2].p.push([Math.PI,configs[_key2].r+2]),configs[_key2].pI.push([rings[_key2][0][3],configs[_key2].r-50]),configs[_key2].pI.push([Math.PI,configs[_key2].r-2])):rings[_key2].forEach(function(r,ri){rings[_key2][ri].push(r[3]),configs[_key2].p.push([r[3],configs[_key2].r+ringScale(r[1])]),configs[_key2].pI.push([r[3],configs[_key2].r-ringScale(r[1])])}),0<rings[_key2].length){configs[_key2].p.push([configs[_key2].p[0][0]+2*Math.PI,configs[_key2].p[0][1]]),configs[_key2].pI.push([configs[_key2].pI[0][0]+2*Math.PI,configs[_key2].pI[0][1]]);var dPath=[configs[_key2].p[0]],dPathI=[configs[_key2].pI[0]];configs[_key2].p.forEach(function(p,pi){if(0<pi){for(var last=dPath[dPath.length-1],diff=p[0]-last[0],rDiff=p[1]-last[1],extra=Math.ceil(diff*(configs[_key2].r/10*2/Math.PI)),_i=0;_i<extra;_i++){var m1=Math.pow(_i/extra,2)*(1-_i/extra),m2=Math.pow(_i/extra,.5)*(_i/extra);dPath.push([last[0]+diff*_i/extra,last[1]+rDiff*(m1+m2)])}dPath.push(p)}}),configs[_key2].pI.forEach(function(p,pi){if(0<pi){for(var last=dPathI[dPathI.length-1],diff=p[0]-last[0],rDiff=p[1]-last[1],extra=Math.ceil(diff*(configs[_key2].r/10*2/Math.PI)),_i2=0;_i2<extra;_i2++){var m1=Math.pow(_i2/extra,2)*(1-_i2/extra),m2=Math.pow(_i2/extra,.5)*(_i2/extra);dPathI.push([last[0]+diff*_i2/extra,last[1]+rDiff*(m1+m2)])}dPathI.push(p)}}),dPathI.reverse();for(var _i3=0;_i3<20;_i3++){var outer=jigger(JSON.parse(JSON.stringify(dPath)),5),inner=jigger(JSON.parse(JSON.stringify(dPathI)),-5);s.append("path").style("fill",configs[_key2].c).attr("d",line(outer)+line(inner)).style("opacity",.025)}}}(_key2);var _key3,_loop2=function(_key3){s.append("g").selectAll("line").data(rings[_key3]).enter().append("path").attr("class","central-links").attr("d",function(d){return function(d,cy2){var x1=module.polarX([d[3],40]),y1=module.polarY([d[3],40]),x2=module.polarX([d[3],cy2]),y2=module.polarY([d[3],cy2]),dir=Math.random(),cx2=Math.random(),cx1=module.polarX([d[3]+(dir<.5?-1:1)*(cx2*Math.PI/180*20),40+.1*(cy2-40)]),cy1=module.polarY([d[3]+(dir<.5?-1:1)*(cx2*Math.PI/180*20),40+.1*(cy2-40)]),o2=Math.random(),cx2=module.polarX([d[3]+(dir<.5?1:-1)*(o2*Math.PI/180*20),40+.9*(cy2-40)]),cy2=module.polarY([d[3]+(dir<.5?1:-1)*(o2*Math.PI/180*20),40+.9*(cy2-40)]);return"M".concat(x1,",").concat(y1,"C").concat(cx1,",").concat(cy1," ").concat(cx2,",").concat(cy2," ").concat(x2,",").concat(y2)}(d,configs[_key3].r)}).attr("fill","transparent").style("stroke","rgba(0,0,0,1)").style("opacity","0.3").style("stroke-width",2).style("stroke-dashArray","4,4"),rings[_key3].forEach(function(r){var shiftI=0;simNodes.push({0:r[3],1:configs[_key3].r,fx:module.polarX([r[3],configs[_key3].r]),fy:module.polarY([r[3],configs[_key3].r]),fixed:!0,dist:8,id:r[0]}),r[2].forEach(function(ri){var similar,simTargets;ri in simNodeKeys||(similar=0,simTargets={sustainability_keywords:[],inner_change_keywords:[]},data.relatives[ri].taxonomy.forEach(function(t){taxonomy[t].taxonomy in configs&&0<=data.taxonomy.indexOf(t)&&(simTargets[taxonomy[t].taxonomy].push(t),similar++)}),0<similar?function(){var sKey,sumAngle=0,sumItems=0;for(sKey in simTargets)!function(sKey){simTargets[sKey].forEach(function(s){sumAngle+=rings[sKey][ringKeys[sKey][s]][3],sumItems++})}(sKey);0<simTargets.sustainability_keywords.length&&0<simTargets.inner_change_keywords.length?simNodes.push({0:sumAngle/sumItems+shiftI*(shiftI%2==0?.3/r[2].length:-.3/r[2].length),1:(configs.sustainability_keywords.r-configs.inner_change_keywords.r)/2+configs.inner_change_keywords.r,dist:similar,id:ri}):simNodes.push({0:sumAngle/sumItems+shiftI*(shiftI%2==0?.3/r[2].length:-.3/r[2].length),1:configs[_key3].r,dist:similar,id:ri})}():simNodes.push({0:r[3]+shiftI*(shiftI%2==0?.3/r[2].length:-.3/r[2].length),1:configs[_key3].r,dist:similar,id:ri}),shiftI++,simNodeKeys[ri]=simNodes.length-1)})})};for(_key3 in rings)_loop2(_key3);for(var simulation=d3.forceSimulation(simNodes).force("x",d3.forceX(module.polarX).strength(1)).force("y",d3.forceY(module.polarY)).force("collide",d3.forceCollide(function(d){return hitScale(d.dist)+2})).stop(),i=0;i<120;++i)simulation.tick();s.append("g").selectAll("g.symbol").data(simNodes).enter().append("g").attr("class","symbol").attr("id",function(d){return"fixed"in d&&d.fixed?"sym-"+d.id:""}).style("opacity",1).attr("transform",function(d){return"translate(".concat("fixed"in d&&d.fixed?d.fx:d.x,",").concat("fixed"in d&&d.fixed?d.fy:d.y,")")}).append("path").style("stroke","none").style("fill",function(d){return"fixed"in d?"transparent":"#000"}).attr("d",d3.symbol().size(function(d){return simScale(d.dist)}).type(function(d){return"fixed"in d?d3.symbolCircle:"institution"==data.relatives[d.id].type?d3.symbolCross:"person"==data.relatives[d.id].type?d3.symbolDiamond:"project"==data.relatives[d.id].type?d3.symbolSquare:"publication"==data.relatives[d.id].type?d3.symbolTriangle:d3.symbolCircle})).style("cursor","pointer").on("mouseover",function(d){"fixed"in d||(module.updateTooltip([d[0],300,data.relatives[d.id].title,d.x,d.y]),d3.selectAll(".item-tax-"+d.id).style("stroke","rgba(0,0,0,0.4)"),d3.selectAll(".symbol").filter(function(dd){return dd.id!=d.id}).style("opacity",.2),d3.selectAll(".central-links").style("opacity",.1),d3.selectAll(".tax-has-"+d.id).style("opacity",1))}).on("mouseout",function(){d3.selectAll(".item-tax").style("stroke","transparent"),tooltip.style("display","none"),d3.selectAll(".symbol").style("opacity",1),d3.selectAll(".central-links").style("opacity",.3),d3.selectAll(".tax").style("opacity",0)}).on("click",function(d){window.location="https://www.ama-project.org/".concat(data.relatives[d.id].type,"/").concat(data.relatives[d.id].slug)});var connections=s.append("g");simNodes.forEach(function(s){s.fixed&&"fixed"in s||data.relatives[s.id].taxonomy.forEach(function(t){var cx1,cx2,cy1,cy2,tx,ty;taxonomy[t].taxonomy in configs&&0<=data.taxonomy.indexOf(t)&&(cy2=s[0]+.25*(rings[taxonomy[t].taxonomy][ringKeys[taxonomy[t].taxonomy][t]][3]-s[0]),tx=s[0]+.75*(rings[taxonomy[t].taxonomy][ringKeys[taxonomy[t].taxonomy][t]][3]-s[0]),ty=d3.max([s[1],configs[taxonomy[t].taxonomy].r]),cx1=module.polarX([cy2,ty]),cx2=module.polarX([tx,ty]),cy1=module.polarY([cy2,ty]),cy2=module.polarY([tx,ty]),tx=module.polarX([rings[taxonomy[t].taxonomy][ringKeys[taxonomy[t].taxonomy][t]][3],configs[taxonomy[t].taxonomy].r]),ty=module.polarY([rings[taxonomy[t].taxonomy][ringKeys[taxonomy[t].taxonomy][t]][3],configs[taxonomy[t].taxonomy].r]),connections.append("path").attr("class","item-tax item-tax-".concat(s.id," item-taxo-").concat(t)).style("stroke","transparent").style("pointer-events","none").style("fill","transparent").attr("d","M".concat(s.x,",").concat(s.y,"C").concat(cx1,",").concat(cy1," ").concat(cx2,",").concat(cy2," ").concat(tx,",").concat(ty)))})});for(var _key4 in rings)!function(_key4){s.append("g").selectAll("circle").data(rings[_key4]).enter().append("circle").attr("cx",function(d){return module.polarX([d[3],configs[_key4].r])}).attr("cy",function(d){return module.polarY([d[3],configs[_key4].r])}).attr("r",5).style("fill",configs[_key4].c).style("stroke","#fff").style("stroke-width",2).style("cursor","pointer").on("mouseover",function(d){d3.selectAll(".item-taxo-"+d[0]).style("stroke","rgba(0,0,0,0.4)"),d3.selectAll("#tax-"+d[0]).style("opacity",1)}).on("mouseout",function(){d3.selectAll(".tax").style("opacity",0),d3.selectAll(".item-tax").style("stroke","transparent")}).on("click",function(d){alert("Show related ".concat(d[0]," to ").concat(id))});var taxTooltips=s.append("g").selectAll("g.tax-tooltip").data(rings[_key4]).enter().append("g").attr("class",function(d){return"tax tax-has-"+taxonomy[d[0]].direct.join(" tax-has-")}).attr("id",function(d){return"tax-"+d[0]}).style("opacity",0).style("pointer-events","none").attr("transform",function(d){return"translate(".concat(module.polarX([d[3],configs[_key4].r]),",").concat(module.polarY([d[3],configs[_key4].r]),")")}),taxTooltipRects=taxTooltips.append("rect");taxTooltips.append("text").attr("id",function(d){return"tax-title-"+d[0]}).text(function(d){return taxonomy[d[0]].name}).attr("text-anchor",function(d){return 0<module.polarX([d[3],configs[_key4].r])?"start":"end"}).attr("dy",4).attr("dx",function(d){return 0<module.polarX([d[3],configs[_key4].r])?15:-15}).style("fill","#fff").style("font-size",12).style("text-transform","capitalize"),taxTooltipRects.attr("style","opacity:0.7; fill:#000; stroke:#000; stroke-width:5; stroke-linejoin:round;").attr("x",function(d){var bb=d3.select("#tax-title-"+d[0]).node().getBoundingClientRect();return 0<module.polarX([d[3],configs[_key4].r])?10:-10-bb.width-10}).attr("y",-8).attr("width",function(d){return d3.select("#tax-title-"+d[0]).node().getBoundingClientRect().width+10}).attr("height",16)}(_key4);var tooltip=s.append("g").style("display","none").style("pointer-events","none"),tooltipLine=tooltip.append("line").style("stroke","rgba(0,0,0,0.4)"),tooltipBg=tooltip.append("path").style("fill","#000").style("stroke","#000").style("stroke-width",5).style("stroke-linejoin","round"),tooltipText=tooltip.append("text").style("fill","#fff").attr("dy",4);module.updateTooltip=function(bb){var dir=bb[3],oy=bb[4],tx=module.polarX([bb[0],bb[1]+50+20]),ty=module.polarY([bb[0],bb[1]+50+20]);tooltipText.attr("transform","translate(".concat(tx+(0<dir?23:-23),",").concat(ty,")")).text(bb[2].length<30?bb[2]:bb[2].substr(0,27)+"...").attr("text-anchor",0<dir?"start":"end");bb=tooltipText.node().getBoundingClientRect();tooltipLine.attr("x1",dir).attr("y1",oy).attr("x2",tx+(0<dir?-2.5:2.5)).attr("y2",ty);dir=0<dir?1:-1;tooltipBg.attr("d","M".concat(tx,",").concat(ty,"L").concat(tx+15*dir,",").concat(ty+15,"L").concat(tx+(15+bb.width+20)*dir,",").concat(ty+15,"L").concat(tx+(15+bb.width+20)*dir,",").concat(ty-15,"L").concat(tx+15*dir,",").concat(ty-15,"Z")),tooltip.style("display","block")};itemTextSize=s.append("g");itemTextSize.append("image").attr("width",80).attr("height",80).attr("x",-40).attr("y",-40).attr("xlink:href",jspath+"/assets/images/icon_"+data.type+"s@2x.png"),itemTextSize.append("circle").attr("r",40).attr("class","item-circle");itembg=s.append("g"),itemTextSize=s.append("g").attr("transform","translate(0,50)").append("text").attr("style","fill:#fff; font-size:20px; font-style:italic;").text(data.title.length<30?data.title:data.title.substr(0,27)+"...").attr("text-anchor","middle").node().getBoundingClientRect();return itembg.append("rect").attr("x",itemTextSize.width/-2-8).attr("y",30).attr("width",itemTextSize.width+16).attr("height",30).attr("fill","#000"),module.responsive=function(){s.attr("transform","translate(".concat(width/2,",").concat(height/2,")"))},module.responsive(),window.addEventListener("resize",debounce(function(){module.updateSize(),module.responsive()})),module};function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function debounce(func,wait,immediate){var timeout;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var context=this,callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(context,args)},wait),callNow&&func.apply(context,args)}}d3.select("#site-navigation button").on("click",function(){var cState=d3.select("#site-navigation").classed("open");cState||(window.scrollTo(0,0),document.body.scrollTop=0),d3.select("#site-navigation").classed("open",!cState)});var state={taxonomy:[],type:[],vis:["network"]},cVis=!1,biPartiteType=!1;function createURL(){var key,keys=[];for(key in state)keys.push(key+"="+state[key].join(","));return"?"+keys.join("&")}function retrieveURL(){state={taxonomy:[],type:[],vis:["network"]};var comps=window.location.href.split("?");1<comps.length&&comps[1].split("&").forEach(function(el){el=el.split("#")[0].split("=");""==el[1]?state[el[0]]=[]:state[el[0]]=el[1].split(",")}),updateUI()}window.addEventListener("popstate",function(){retrieveURL()});var dispatcher=d3.history("action");dispatcher.on("action",function(){updateUI()});var filter={taxonomy:[],type:[]};function updateFilter(){var key,changed=!1;for(key in state)!function(key){state[key].forEach(function(s){-1==filter[key].indexOf(s)&&(changed=!0,filter[key].push(s))})}(key);changed&&dispatcher.call("action",this,createURL())}function updateUI(){var _this=this;if("vis"in state||(state.vis=["network"]),(0<window.innerWidth?window.innerWidth:screen.width)<768)siteType&&"detail"==siteType?d3.select("#svg-container").style("background-image","url(".concat(jspath,"/assets/images/mobile_snap_detail_").concat(state.vis[0],"@2x.jpg)")):d3.select("#svg-container").style("background-image","url(".concat(jspath,"/assets/images/mobile_snap_explore_").concat(state.vis[0],"@2x.jpg)"));else if(d3.select("#svg-container").style("background-image","none"),cVis!=state.vis[0])switch(cVis=state.vis[0],d3.selectAll("#svg-container *").remove(),d3.selectAll("#svg-container").classed("network",!1).classed("map",!1).classed("matrix",!1).classed("bipartite",!1).classed(state.vis[0],!0),state.vis[0]){case"network":updateTypeFilter(!0),updateTaxFilter(!0);var key,taxLimit=!1;for(key in nodes)key==siteID&&(taxLimit=nodes[key].taxonomy);network=networkOverallThematic(d3.select("#svg-container"),nodes,taxonomy,"detail"==siteType&&siteID,function(selection){state.taxonomy=selection,dispatcher.call("action",_this,createURL())},"detail"==siteType&&taxLimit,"detail"==siteType);break;case"map":updateTypeFilter(!1),updateTaxFilter(!0),Promise.all([jspath+"/cache/"+jsppath+"geo_network_nodes.json",jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(geoNodes){var _taxonomy=_slicedToArray(geoNodes,2),geoNodes=_taxonomy[0],_taxonomy=_taxonomy[1];map=mapCluster(d3.select("#svg-container"),geoNodes,_taxonomy,function(selection){console.log(state.taxonomy,selection),state.taxonomy[0]==selection[0]?state.taxonomy=[]:state.taxonomy=selection,dispatcher.call("action",_this,createURL())}),updateUI()}).catch(function(e){throw e});break;case"matrix":updateTypeFilter(!0),updateTaxFilter(!1),Promise.all([jspath+"/cache/"+jsppath+fullFile,jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_nodes){var _taxonomy=_slicedToArray(_nodes,2),_nodes=_taxonomy[0],_taxonomy=_taxonomy[1];matrix=matrixRect(d3.select("#svg-container"),_nodes,_taxonomy,function(selection){state.taxonomy=selection,dispatcher.call("action",_this,createURL())}),updateUI()}).catch(function(e){throw e});break;case"radial":updateTypeFilter(!1),updateTaxFilter(!1),Promise.all([jspath+"/cache/"+fullFile,jspath+"/cache/taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_nodes){var _taxonomy=_slicedToArray(_nodes,2),_nodes=_taxonomy[0],_taxonomy=_taxonomy[1];rings(d3.select("#svg-container"),_nodes,_taxonomy,siteID)}).catch(function(e){throw e});break;case"flow":updateTypeFilter(!1),updateTaxFilter(!1),Promise.all([jspath+"/cache/"+jsppath+fullFile,jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_nodes){var _taxonomy=_slicedToArray(_nodes,2),_nodes=_taxonomy[0],_taxonomy=_taxonomy[1];flow(d3.select("#svg-container"),_nodes,_taxonomy)}).catch(function(e){throw e});break;case"bipartite":updateTypeFilter(!0),updateTaxFilter(!1),0==state.type.length?(_hibipart=biPartiteType=!1,Promise.all([jspath+"/cache/"+jsppath+"cat_nodes_clean_min.csv",jspath+"/cache/"+jsppath+"cat_edges_all_grouped_min.csv"].map(function(d){return d3.csv(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_ref10){_ref10=_slicedToArray(_ref10,2);setupBiPartite(_ref10[0],_ref10[1])}).catch(function(e){throw e})):(biPartiteType=state.type[0],_hibipart=!1,Promise.all([jspath+"/cache/"+jsppath+"cat_nodes_clean_min-"+state.type[0]+".csv",jspath+"/cache/"+jsppath+"cat_edges_all_grouped_min-"+state.type[0]+".csv"].map(function(d){return d3.csv(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_ref12){_ref12=_slicedToArray(_ref12,2);setupBiPartite(_ref12[0],_ref12[1])}).catch(function(e){throw e}))}d3.selectAll("#vis-nav a").classed("active",!1),d3.select("#vis-nav .".concat(state.vis[0]," a")).classed("active",!0);var cSel=listFunc.selection;d3.selectAll("#type-nav a").classed("active",!1),(0<window.innerWidth?window.innerWidth:screen.width)<768?cSel.type=0==state.type.length?[]:[state.type[0]]:0==state.type.length?("network"==state.vis[0]?0<network.filterType.length&&(network.resetSelection(),network.resetFilter(!0)):"matrix"==state.vis[0]&&matrix&&(matrix.filter="all"),"bipartite"==state.vis[0]&&0!=biPartiteType&&(_hibipart=biPartiteType=!1,d3.selectAll("#svg-container *").remove(),Promise.all([jspath+"/cache/"+jsppath+"cat_nodes_clean_min.csv",jspath+"/cache/"+jsppath+"cat_edges_all_grouped_min.csv"].map(function(d){return d3.csv(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_ref14){_ref14=_slicedToArray(_ref14,2);setupBiPartite(_ref14[0],_ref14[1])}).catch(function(e){throw e})),cSel.type=[]):("network"==state.vis[0]?network.filterType[0]!=state.type[0]&&(network.resetSelection(),network.resetFilter(!1),network.applyFilter("type",state.type[0],!0)):"matrix"==state.vis[0]&&matrix&&(matrix.filter=state.type[0]),"bipartite"==state.vis[0]&&biPartiteType!=state.type[0]&&(biPartiteType=state.type[0],_hibipart=!1,d3.selectAll("#svg-container *").remove(),Promise.all([jspath+"/cache/"+jsppath+"cat_nodes_clean_min-"+state.type[0]+".csv",jspath+"/cache/"+jsppath+"cat_edges_all_grouped_min-"+state.type[0]+".csv"].map(function(d){return d3.csv(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_ref16){_ref16=_slicedToArray(_ref16,2);setupBiPartite(_ref16[0],_ref16[1])}).catch(function(e){throw e})),cSel.type=[state.type[0]]),(0<window.innerWidth?window.innerWidth:screen.width)<768?cSel.taxonomy=0==state.taxonomy.length?[]:state.taxonomy:0==state.taxonomy.length?("network"==state.vis[0]?(network.resetSelection(),network.updateSelection()):"matrix"==state.vis[0]&&matrix?(matrix.selection=[],matrix.updateSelection()):"map"==state.vis[0]&&map&&(map.selection=[],map.updateSelection()),"bipartite"==state.vis[0]&&_hibipart&&0<=_hibipart.getArcFilters().length&&(_hibipart.reset(),_hibipartVis.linkModules(),_hibipartVis.update()),cSel.taxonomy=[]):("network"==state.vis[0]?(network.selection=state.taxonomy,network.updateSelection()):"matrix"==state.vis[0]&&matrix?(matrix.selection=state.taxonomy,matrix.updateSelection()):"map"==state.vis[0]&&map&&(map.selection=state.taxonomy,map.updateSelection()),"bipartite"==state.vis[0]&&_hibipart&&(_hibipart.reset(),state.taxonomy.forEach(function(tax){_hibipart.filter(+tax)}),_hibipartVis.linkModules(),_hibipartVis.update()),cSel.taxonomy=state.taxonomy),0<state.type.length&&d3.select("#type-nav .".concat(state.type[0]," a")).classed("active",!0),listFunc.selection=cSel,listFunc.visType=state.vis[0]}function updateTypeFilter(disabled){d3.selectAll("#type-nav a").classed("disabled",!disabled)}function updateTaxFilter(disabled){d3.selectAll("#filter-nav .filter-block").classed("disabled",!disabled)}function setupBiPartite(nodes,edges){var _this2=this;_hibipart=hibipart(),_hibipart.idAccessor(function(d){return d.id}).parentAccessor(function(d){return d.parent}).nameAccessor(function(d){return d.name}).sideAccessor(function(d){return d.systematic}),(nodes=nodes.filter(function(d){return"c_s"==d.systematic||"c_ic"==d.systematic})).forEach(function(n){for(var key in n)"name"!=key&&"systematic"!=key&&(n[key]=+n[key])}),edges.forEach(function(e){for(var key in e)e[key]=+e[key]}),_hibipart.init(nodes,edges),_hibipartVis=hibipartVis(d3.select("#svg-container"),function(id,addRemove){!addRemove&&(0<=state.taxonomy.indexOf(id)||0<=state.taxonomy.indexOf(""+id))?state.taxonomy.splice(state.taxonomy.indexOf(parseInt(id)),1):addRemove&&state.taxonomy.push(id),dispatcher.call("action",_this2,createURL())}),_hibipartVis.bipart(_hibipart).sides({c_ic:{start:Math.PI/180*225,end:Math.PI/180*315},c_s:{start:Math.PI/180*45,end:Math.PI/180*135}}).render(),updateUI()}var contentCatsMode=1;function toggleContentCats(){0==contentCatsMode?(contentCatsMode=1,d3.selectAll(".single .content-cats .term").style("display","inline-block"),d3.select(".content-cats-toggle").html("&#x002D; Show less terms")):(contentCatsMode=0,d3.selectAll(".single .content-cats .term").style("display",function(d,i){return i<4?"inline-block":"none"}),d3.select(".content-cats-toggle").html("&#10010; Show all "+d3.selectAll(".single .content-cats .term").size()+" terms"))}1<=d3.select(".single .content-cats").size()&&4<d3.selectAll(".single .content-cats .term").size()&&(contentCatsMode=1,toggleContentCats(),d3.select(".single .content-cats").append("div").attr("class","content-cats-toggle-container").append("a").attr("class","content-cats-toggle").html("&#10010; Show all "+d3.selectAll(".single .content-cats .term").size()+" terms").on("click",function(){toggleContentCats()}));var iconBuilder=function(){var arc=d3.arc().innerRadius(38).outerRadius(38),colors={ic:"#AD245C",s:"#0A9EA3",none:"#000000"},icons=d3.selectAll(".icon").datum(function(){var ic=d3.select(this),s=+ic.attr("data-s"),ic=+ic.attr("data-ic");return{icon:d3.select(this).attr("data-icon"),s:s,ic:ic,none:0==ic&&0==s?1:0,full:s+ic,els:0==ic||0==s?1:2}}).append("svg").attr("width",80).attr("height",80);icons.append("image").attr("xlink:href",function(d){return d.icon}).attr("width",80).attr("height",80);var igs=icons.append("g").attr("transform","translate(40,40)");["s","ic","none"].forEach(function(type){igs.append("path").style("stroke",colors[type]).attr("title",type).style("stroke-width",2.5).style("stroke-linecap","round").style("stroke-linejoin","round").attr("d",function(end){var start;return 0!=end[type]?(end=2==end.els?"s"==type?(start=Math.PI/4,Math.PI/180*(346*end[type]/end.full)+Math.PI/4):(start=Math.PI/180*(346*end.s/end.full)+Math.PI/4+Math.PI/180*7,2.25*Math.PI-Math.PI/180*7):(start=0,2*Math.PI),arc({startAngle:start,endAngle:end})):""})})},_this=this;function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(arr)){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var _width,_height,filterTypes,filterLabels,filterIcons,foundFilters,filterContainer,icons=iconBuilder();function updateFilterSide(){window.pageYOffset>height/2?d3.selectAll("#filter-nav .dropdown").classed("top",!1):d3.selectAll("#filter-nav .dropdown").classed("top",!0)}function updateResize(){width=window.innerWidth,height=window.innerHeight,1<=d3.select("#filters").size()?d3.selectAll("#content").style("top",height-110+"px"):d3.selectAll("#content").style("top",height-210+"px")}1<=d3.select("#svg-container").size()&&(_width=window.innerWidth,_height=window.innerHeight,d3.select("#svg-container").attr("width",_width).attr("height",_height),1<=d3.select("#filters").size()?d3.selectAll("#content").style("top",_height-110+"px"):d3.selectAll("#content").style("top",_height-210+"px"),window.scrollTo(0,Math.round(_height/2)),document.body.scrollTop=Math.round(_height/2),d3.select("#explore-message").style("top",Math.round(_height/4)),Promise.all([jspath+"/cache/"+jsppath+siteFile,jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_nodes){var listCon=_slicedToArray(_nodes,2),_nodes=listCon[0],listCon=listCon[1];nodes=_nodes,taxonomy=listCon;listCon=d3.select("#explore-con");listCon.selectAll("*").remove(),updateResize(),listFunc=list(listCon,nodes,taxonomy),listFunc.update(),retrieveURL()}).catch(function(e){throw e})),updateResize(),1<=d3.select("#svg-container").size()&&(updateFilterSide(),d3.select(window).on("scroll",debounce(function(){updateFilterSide()},200)),updateResize(),d3.select(window).on("resize",debounce(function(){updateResize()},200))),1<=d3.select("#matrix-circle-container").size()&&Promise.all([jspath+"/cache/"+jsppath+"iass.json",jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_taxonomy){var listCon=_slicedToArray(_taxonomy,2),tNodes=listCon[0],_taxonomy=listCon[1],listCon=d3.select("#matrix-circle-list");listCon.selectAll("*").remove();tNodes=tNodes.filter(function(n){return 15!=n.id});listFunc=list(listCon,tNodes,_taxonomy),listFunc.update(),matrixCircle(d3.select("#matrix-circle-container"),listFunc,tNodes,_taxonomy)}).catch(function(e){throw e}),["person","institution","project","publication"].forEach(function(type){d3.select("#type-nav .".concat(type," a")).attr("href",null).on("click",function(d,i,_nodes){d3.select(_nodes[i]).classed("disabled")||(state.type[0]==type?state.type=[]:state.type[0]=type,state.taxonomy=[],dispatcher.call("action",_this,createURL()))})}),["map","network","bipartite","flow","radial","matrix"].forEach(function(type){d3.select("#vis-nav .".concat(type)).attr("href",null).on("click",function(){state.vis[0]=type,state.taxonomy=[],dispatcher.call("action",_this,createURL())})}),1<=d3.select("#home-svg").size()&&Promise.all([jspath+"/cache/"+jsppath+siteFile,jspath+"/cache/"+jsppath+"taxonomy.json"].map(function(d){return d3.json(d,{headers:{Authorization:"Basic "+btoa("iass:amama2017")}})})).then(function(_nodes){var _taxonomy=_slicedToArray(_nodes,2),_nodes=_taxonomy[0],_taxonomy=_taxonomy[1];networkHome(d3.select("#home-svg"),_nodes,_taxonomy).init()}).catch(function(e){throw e}),1<=d3.select("#search-results.has-results").size()&&(filterLabels=["Persons","Institutions","Projects","Publications"],filterIcons=["M0,-2.942830956382712L1.6990442448471226,0L0,2.942830956382712L-1.6990442448471226,0Z","M-2.121320343559643,-0.7071067811865476L-0.7071067811865476,-0.7071067811865476L-0.7071067811865476,-2.121320343559643L0.7071067811865476,-2.121320343559643L0.7071067811865476,-0.7071067811865476L2.121320343559643,-0.7071067811865476L2.121320343559643,0.7071067811865476L0.7071067811865476,0.7071067811865476L0.7071067811865476,2.121320343559643L-0.7071067811865476,2.121320343559643L-0.7071067811865476,0.7071067811865476L-2.121320343559643,0.7071067811865476Z","M-1.5811388300841898,-1.5811388300841898h3.1622776601683795v3.1622776601683795h-3.1622776601683795Z","M0,-2.7745276335252114L2.402811414134754,1.3872638167626057L-2.402811414134754,1.3872638167626057Z"],foundFilters=[],(filterTypes=[{id:0,type:"person"},{id:1,type:"institution"},{id:2,type:"project"},{id:3,type:"publication"}]).forEach(function(f){foundFilters.push(1<=d3.select(".connection.c-type-".concat(f.type)).size())}),(filterContainer=d3.select("header.page-header").append("div").attr("id","filters")).append("span").text("Filter your search results:"),filterContainer.append("ul").attr("id","type-nav").selectAll("li").data(filterTypes.filter(function(d,i){return foundFilters[i]})).enter().append("li").attr("class",function(d){return d.type}).append("a").html(function(d){return'<svg width="16" height="16"><g transform="translate(8,8) scale(2)"><path d="'.concat(filterIcons[d.id],'" style="fill: rgb(0, 0, 0); stroke: transparent;"></path></g></svg><br>').concat(filterLabels[d.id])}).on("click",function(d){1==d3.select(this).classed("active")?(d3.select(this).classed("active",!1),d3.selectAll(".connection").style("display","block").classed("on-show",!0)):(d3.selectAll("#type-nav a").classed("active",!1),d3.select(this).classed("active",!0),d3.selectAll(".connection").style("display","none").classed("on-show",!1),d3.selectAll(".connection.c-type-"+d.type).style("display","block").classed("on-show",!0)),d3.selectAll(".connection.on-show").classed("b1",function(d,i){return!(i%2)}).classed("b2",function(d,i){return!!(i%2)}).classed("c1",function(d,i){return 1==i+1-3*Math.floor((i+1)/3)}).classed("c2",function(d,i){return 2==i+1-3*Math.floor((i+1)/3)}).classed("c3",function(d,i){return 0==i+1-3*Math.floor((i+1)/3)})}));